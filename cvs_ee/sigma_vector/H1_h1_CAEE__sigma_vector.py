## h1 <- h1 coupling contributions
from . import logger, tools, ascontiguousarray

# CCAA <- CAEE: NO CONTRIBUTION

# CCEA <- CAEE
def compute_sigma_vector__H1__h1_h1__CCEA_CAEE(mr_adc, X_aaaa, X_abab, X_baba, X_bbbb, sigma):
    cput1 = (logger.process_clock(), logger.perf_counter())

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    #Excitation Manifold
    ccea__aaaa = mr_adc.h1.ccea__aaaa
    ccea__abab = mr_adc.h1.ccea__abab
    ccea__abba = mr_adc.h1.ccea__abba
    ccea__bbbb = mr_adc.h1.ccea__bbbb 

    ## Indices
    cc_tril_ind = mr_adc.h1.cc_tril_ind 

    ## Two-electron integrals
    v_xaea = mr_adc.v2e.xaea

    # Reduced Density Matrices
    rdm_ca = mr_adc.rdm.ca
    rdm_ccaa = mr_adc.rdm.ccaa

    sigma_KLCW_aaaa  = 1/2 * einsum('KxCa,LWay,xy->KLCW', X_aaaa, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_aaaa -= 1/2 * einsum('KxCa,LyaW,xy->KLCW', X_aaaa, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_aaaa -= 1/6 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_aaaa, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_aaaa += 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_aaaa, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_aaaa -= 1/2 * einsum('LxCa,KWay,xy->KLCW', X_aaaa, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_aaaa += 1/2 * einsum('LxCa,KyaW,xy->KLCW', X_aaaa, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_aaaa += 1/6 * einsum('LxCa,Kyaz,Wxyz->KLCW', X_aaaa, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_aaaa -= 1/6 * einsum('LxCa,Kyaz,Wxzy->KLCW', X_aaaa, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_aaaa += 1/2 * einsum('KxCa,LWay,xy->KLCW', X_abab, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_aaaa -= 1/3 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_abab, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_aaaa -= 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_abab, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_aaaa -= 1/2 * einsum('LxCa,KWay,xy->KLCW', X_abab, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_aaaa += 1/3 * einsum('LxCa,Kyaz,Wxyz->KLCW', X_abab, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_aaaa += 1/6 * einsum('LxCa,Kyaz,Wxzy->KLCW', X_abab, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma[ccea__aaaa] += ascontiguousarray(sigma_KLCW_aaaa[cc_tril_ind[0], cc_tril_ind[1]]).reshape(-1)

    sigma_KLCW_abab  = 1/2 * einsum('KxCa,LWay,xy->KLCW', X_aaaa, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_abab -= 1/3 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_aaaa, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abab -= 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_aaaa, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abab += 1/2 * einsum('KxCa,LWay,xy->KLCW', X_abab, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_abab -= 1/2 * einsum('KxCa,LyaW,xy->KLCW', X_abab, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_abab -= 1/6 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_abab, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abab += 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_abab, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abab -= 1/2 * einsum('LxaC,KyaW,xy->KLCW', X_baba, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_abab += 1/6 * einsum('LxaC,Kyaz,Wxyz->KLCW', X_baba, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abab += 1/3 * einsum('LxaC,Kyaz,Wxzy->KLCW', X_baba, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma[ccea__abab] += ascontiguousarray(sigma_KLCW_abab).reshape(-1)

    sigma_KLCW_abba  = 1/2 * einsum('KxaC,LyaW,xy->KLCW', X_abab, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_abba -= 1/6 * einsum('KxaC,Lyaz,Wxyz->KLCW', X_abab, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abba -= 1/3 * einsum('KxaC,Lyaz,Wxzy->KLCW', X_abab, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abba -= 1/2 * einsum('LxCa,KWay,xy->KLCW', X_baba, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_abba += 1/2 * einsum('LxCa,KyaW,xy->KLCW', X_baba, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_abba += 1/6 * einsum('LxCa,Kyaz,Wxyz->KLCW', X_baba, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abba -= 1/6 * einsum('LxCa,Kyaz,Wxzy->KLCW', X_baba, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abba -= 1/2 * einsum('LxCa,KWay,xy->KLCW', X_bbbb, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_abba += 1/3 * einsum('LxCa,Kyaz,Wxyz->KLCW', X_bbbb, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abba += 1/6 * einsum('LxCa,Kyaz,Wxzy->KLCW', X_bbbb, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma[ccea__abba] += ascontiguousarray(sigma_KLCW_abba).reshape(-1)

    sigma_KLCW_bbbb  = 1/2 * einsum('KxCa,LWay,xy->KLCW', X_baba, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_bbbb -= 1/3 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_baba, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_bbbb -= 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_baba, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_bbbb -= 1/2 * einsum('LxCa,KWay,xy->KLCW', X_baba, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_bbbb += 1/3 * einsum('LxCa,Kyaz,Wxyz->KLCW', X_baba, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_bbbb += 1/6 * einsum('LxCa,Kyaz,Wxzy->KLCW', X_baba, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_bbbb += 1/2 * einsum('KxCa,LWay,xy->KLCW', X_bbbb, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_bbbb -= 1/2 * einsum('KxCa,LyaW,xy->KLCW', X_bbbb, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_bbbb -= 1/6 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_bbbb, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_bbbb += 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_bbbb, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_bbbb -= 1/2 * einsum('LxCa,KWay,xy->KLCW', X_bbbb, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_bbbb += 1/2 * einsum('LxCa,KyaW,xy->KLCW', X_bbbb, v_xaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_bbbb += 1/6 * einsum('LxCa,Kyaz,Wxyz->KLCW', X_bbbb, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_bbbb -= 1/6 * einsum('LxCa,Kyaz,Wxzy->KLCW', X_bbbb, v_xaea, rdm_ccaa, optimize = einsum_type)
    sigma[ccea__bbbb] += ascontiguousarray(sigma_KLCW_bbbb[cc_tril_ind[0], cc_tril_ind[1]]).reshape(-1)

    mr_adc.log.timer_debug("computing sigma H1 h1-h1 CCEA-CAEE", *cput1)
 
# CCEE <- CAEE
def compute_sigma_vector__H1__h1_h1__CCEE_CAEE(mr_adc, X_aaaa, X_abab, X_baba, X_bbbb, sigma):
    cput1 = (logger.process_clock(), logger.perf_counter())

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    #Excitation Manifold
    ccee__aaaa = mr_adc.h1.ccee__aaaa
    ccee__abab = mr_adc.h1.ccee__abab
    ccee__bbbb = mr_adc.h1.ccee__bbbb 

    ## Indices
    cc_tril_ind = mr_adc.h1.cc_tril_ind 
    ee_tril_ind = mr_adc.h1.ee_tril_ind 

    ## Molecular Orbitals Energies
    e_cvs = mr_adc.mo_energy.x

    ## One-electron integrals
    h_xa = mr_adc.h1eff.xa
    h_aa = mr_adc.h1eff.aa

    ## Two-electron integrals
    v_xxxa = mr_adc.v2e.xxxa
    v_xaaa = mr_adc.v2e.xaaa
    v_xaee = mr_adc.v2e.xaee
    v_xeea = mr_adc.v2e.xeea
    v_aaaa = mr_adc.v2e.aaaa

    ## Amplitudes
    t1_xa = mr_adc.t1.xa
    t1_xaaa = mr_adc.t1.xaaa

    # Reduced Density Matrices
    rdm_ca = mr_adc.rdm.ca
    rdm_ccaa = mr_adc.rdm.ccaa

    sigma_KLCD_aaaa =- einsum('KxCD,Lx->KLCD', X_aaaa, h_xa, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('LxCD,Kx->KLCD', X_aaaa, h_xa, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('KxCD,L,Lx->KLCD', X_aaaa, e_cvs, t1_xa, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('LxCD,K,Kx->KLCD', X_aaaa, e_cvs, t1_xa, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,xy,Ly->KLCD', X_aaaa, h_aa, t1_xa, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('LxCD,xy,Ky->KLCD', X_aaaa, h_aa, t1_xa, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,Lxyz,yz->KLCD', X_aaaa, v_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Lyzx,zy->KLCD', X_aaaa, v_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_aaaa, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxCa,LyaD,xy->KLCD', X_aaaa, v_xaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxDa,LCay,xy->KLCD', X_aaaa, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxDa,LyaC,xy->KLCD', X_aaaa, v_xaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('LxCD,Kxyz,yz->KLCD', X_aaaa, v_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('LxCD,Kyzx,zy->KLCD', X_aaaa, v_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('LxCa,KDay,xy->KLCD', X_aaaa, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('LxCa,KyaD,xy->KLCD', X_aaaa, v_xaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('LxDa,KCay,xy->KLCD', X_aaaa, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('LxDa,KyaC,xy->KLCD', X_aaaa, v_xaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('ixCD,KiLy,xy->KLCD', X_aaaa, v_xxxa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('ixCD,LiKy,xy->KLCD', X_aaaa, v_xxxa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_abab, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxDa,LCay,xy->KLCD', X_abab, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('LxCa,KDay,xy->KLCD', X_abab, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('LxDa,KCay,xy->KLCD', X_abab, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('KxCD,L,Lyxz,yz->KLCD', X_aaaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxCD,L,Lyzx,yz->KLCD', X_aaaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('LxCD,K,Kyxz,yz->KLCD', X_aaaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('LxCD,K,Kyzx,yz->KLCD', X_aaaa, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,xy,Lzwy,zw->KLCD', X_aaaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,xy,Lzyw,zw->KLCD', X_aaaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,yz,Lwxy,zw->KLCD', X_aaaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,yz,Lwyx,zw->KLCD', X_aaaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxCD,yz,Lywx,zw->KLCD', X_aaaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('KxCD,yz,Lyxw,zw->KLCD', X_aaaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('LxCD,xy,Kzwy,zw->KLCD', X_aaaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('LxCD,xy,Kzyw,zw->KLCD', X_aaaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('LxCD,yz,Kwxy,zw->KLCD', X_aaaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('LxCD,yz,Kwyx,zw->KLCD', X_aaaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('LxCD,yz,Kywx,zw->KLCD', X_aaaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('LxCD,yz,Kyxw,zw->KLCD', X_aaaa, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,Ly,xyzw,zw->KLCD', X_aaaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Ly,xzwy,wz->KLCD', X_aaaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('KxCD,Lyxz,ywuv,zuwv->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,Lyxz,zwuv,yuwv->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Lyzw,xuvw,yuvz->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Lyzw,xuvz,yuwv->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxCD,Lyzw,xuyv,zwuv->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Lyzw,xwuv,yvzu->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Lyzw,xwuz,yu->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,Lyzw,xzuv,yvwu->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,Lyzw,xzuw,yu->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxCD,Lyzx,ywuv,zuwv->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Lyzx,zwuv,yuwv->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('LxCD,Ky,xyzw,zw->KLCD', X_aaaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('LxCD,Ky,xzwy,wz->KLCD', X_aaaa, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('LxCD,Kyxz,ywuv,zuwv->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('LxCD,Kyxz,zwuv,yuwv->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('LxCD,Kyzw,xuvw,yuvz->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('LxCD,Kyzw,xuvz,yuwv->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('LxCD,Kyzw,xuyv,zwuv->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('LxCD,Kyzw,xwuv,yvzu->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('LxCD,Kyzw,xwuz,yu->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('LxCD,Kyzw,xzuv,yvwu->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('LxCD,Kyzw,xzuw,yu->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('LxCD,Kyzx,ywuv,zuwv->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('LxCD,Kyzx,zwuv,yuwv->KLCD', X_aaaa, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa = sigma_KLCD_aaaa[:, :, ee_tril_ind[0], ee_tril_ind[1]]
    sigma[ccee__aaaa] += ascontiguousarray(sigma_KLCD_aaaa[cc_tril_ind[0], cc_tril_ind[1]]).reshape(-1)

    sigma_KLCD_abab =- einsum('KxCD,Lx->KLCD', X_abab, h_xa, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('LxDC,Kx->KLCD', X_baba, h_xa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_aaaa, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += einsum('KxCD,L,Lx->KLCD', X_abab, e_cvs, t1_xa, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,xy,Ly->KLCD', X_abab, h_aa, t1_xa, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,Lxyz,yz->KLCD', X_abab, v_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Lyzx,zy->KLCD', X_abab, v_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_abab, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('KxCa,LyaD,xy->KLCD', X_abab, v_xaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('KxaD,LyaC,xy->KLCD', X_abab, v_xaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('ixCD,KiLy,xy->KLCD', X_abab, v_xxxa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += einsum('LxDC,K,Kx->KLCD', X_baba, e_cvs, t1_xa, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('LxDC,xy,Ky->KLCD', X_baba, h_aa, t1_xa, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('LxDC,Kxyz,yz->KLCD', X_baba, v_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('LxDC,Kyzx,zy->KLCD', X_baba, v_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('LxDa,KCay,xy->KLCD', X_baba, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('LxDa,KyaC,xy->KLCD', X_baba, v_xaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('LxaC,KyaD,xy->KLCD', X_baba, v_xaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('ixDC,LiKy,xy->KLCD', X_baba, v_xxxa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('LxDa,KCay,xy->KLCD', X_bbbb, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += einsum('KxCD,L,Lyxz,yz->KLCD', X_abab, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('KxCD,L,Lyzx,yz->KLCD', X_abab, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,xy,Lzwy,zw->KLCD', X_abab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,xy,Lzyw,zw->KLCD', X_abab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,yz,Lwxy,zw->KLCD', X_abab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,yz,Lwyx,zw->KLCD', X_abab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('KxCD,yz,Lywx,zw->KLCD', X_abab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += einsum('KxCD,yz,Lyxw,zw->KLCD', X_abab, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,Ly,xyzw,zw->KLCD', X_abab, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Ly,xzwy,wz->KLCD', X_abab, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += einsum('KxCD,Lyxz,ywuv,zuwv->KLCD', X_abab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,Lyxz,zwuv,yuwv->KLCD', X_abab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Lyzw,xuvw,yuvz->KLCD', X_abab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Lyzw,xuvz,yuwv->KLCD', X_abab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('KxCD,Lyzw,xuyv,zwuv->KLCD', X_abab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Lyzw,xwuv,yvzu->KLCD', X_abab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Lyzw,xwuz,yu->KLCD', X_abab, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,Lyzw,xzuv,yvwu->KLCD', X_abab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,Lyzw,xzuw,yu->KLCD', X_abab, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('KxCD,Lyzx,ywuv,zuwv->KLCD', X_abab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Lyzx,zwuv,yuwv->KLCD', X_abab, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += einsum('LxDC,K,Kyxz,yz->KLCD', X_baba, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('LxDC,K,Kyzx,yz->KLCD', X_baba, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('LxDC,xy,Kzwy,zw->KLCD', X_baba, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('LxDC,xy,Kzyw,zw->KLCD', X_baba, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('LxDC,yz,Kwxy,zw->KLCD', X_baba, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('LxDC,yz,Kwyx,zw->KLCD', X_baba, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('LxDC,yz,Kywx,zw->KLCD', X_baba, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += einsum('LxDC,yz,Kyxw,zw->KLCD', X_baba, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('LxDC,Ky,xyzw,zw->KLCD', X_baba, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('LxDC,Ky,xzwy,wz->KLCD', X_baba, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += einsum('LxDC,Kyxz,ywuv,zuwv->KLCD', X_baba, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('LxDC,Kyxz,zwuv,yuwv->KLCD', X_baba, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('LxDC,Kyzw,xuvw,yuvz->KLCD', X_baba, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('LxDC,Kyzw,xuvz,yuwv->KLCD', X_baba, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('LxDC,Kyzw,xuyv,zwuv->KLCD', X_baba, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('LxDC,Kyzw,xwuv,yvzu->KLCD', X_baba, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('LxDC,Kyzw,xwuz,yu->KLCD', X_baba, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('LxDC,Kyzw,xzuv,yvwu->KLCD', X_baba, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('LxDC,Kyzw,xzuw,yu->KLCD', X_baba, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('LxDC,Kyzx,ywuv,zuwv->KLCD', X_baba, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('LxDC,Kyzx,zwuv,yuwv->KLCD', X_baba, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma[ccee__abab] += ascontiguousarray(sigma_KLCD_abab).reshape(-1)


    sigma_KLCD_bbbb =- einsum('KxCD,Lx->KLCD', X_bbbb, h_xa, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('LxCD,Kx->KLCD', X_bbbb, h_xa, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_baba, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxDa,LCay,xy->KLCD', X_baba, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('LxCa,KDay,xy->KLCD', X_baba, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('LxDa,KCay,xy->KLCD', X_baba, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('KxCD,L,Lx->KLCD', X_bbbb, e_cvs, t1_xa, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('LxCD,K,Kx->KLCD', X_bbbb, e_cvs, t1_xa, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,xy,Ly->KLCD', X_bbbb, h_aa, t1_xa, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('LxCD,xy,Ky->KLCD', X_bbbb, h_aa, t1_xa, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,Lxyz,yz->KLCD', X_bbbb, v_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Lyzx,zy->KLCD', X_bbbb, v_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_bbbb, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxCa,LyaD,xy->KLCD', X_bbbb, v_xaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxDa,LCay,xy->KLCD', X_bbbb, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxDa,LyaC,xy->KLCD', X_bbbb, v_xaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('LxCD,Kxyz,yz->KLCD', X_bbbb, v_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('LxCD,Kyzx,zy->KLCD', X_bbbb, v_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('LxCa,KDay,xy->KLCD', X_bbbb, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('LxCa,KyaD,xy->KLCD', X_bbbb, v_xaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('LxDa,KCay,xy->KLCD', X_bbbb, v_xeea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('LxDa,KyaC,xy->KLCD', X_bbbb, v_xaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('ixCD,KiLy,xy->KLCD', X_bbbb, v_xxxa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('ixCD,LiKy,xy->KLCD', X_bbbb, v_xxxa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('KxCD,L,Lyxz,yz->KLCD', X_bbbb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxCD,L,Lyzx,yz->KLCD', X_bbbb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('LxCD,K,Kyxz,yz->KLCD', X_bbbb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('LxCD,K,Kyzx,yz->KLCD', X_bbbb, e_cvs, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,xy,Lzwy,zw->KLCD', X_bbbb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,xy,Lzyw,zw->KLCD', X_bbbb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,yz,Lwxy,zw->KLCD', X_bbbb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,yz,Lwyx,zw->KLCD', X_bbbb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxCD,yz,Lywx,zw->KLCD', X_bbbb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('KxCD,yz,Lyxw,zw->KLCD', X_bbbb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('LxCD,xy,Kzwy,zw->KLCD', X_bbbb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('LxCD,xy,Kzyw,zw->KLCD', X_bbbb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('LxCD,yz,Kwxy,zw->KLCD', X_bbbb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('LxCD,yz,Kwyx,zw->KLCD', X_bbbb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('LxCD,yz,Kywx,zw->KLCD', X_bbbb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('LxCD,yz,Kyxw,zw->KLCD', X_bbbb, h_aa, t1_xaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,Ly,xyzw,zw->KLCD', X_bbbb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Ly,xzwy,wz->KLCD', X_bbbb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('KxCD,Lyxz,ywuv,zuwv->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,Lyxz,zwuv,yuwv->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Lyzw,xuvw,yuvz->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Lyzw,xuvz,yuwv->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxCD,Lyzw,xuyv,zwuv->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Lyzw,xwuv,yvzu->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Lyzw,xwuz,yu->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,Lyzw,xzuv,yvwu->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,Lyzw,xzuw,yu->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxCD,Lyzx,ywuv,zuwv->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Lyzx,zwuv,yuwv->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('LxCD,Ky,xyzw,zw->KLCD', X_bbbb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('LxCD,Ky,xzwy,wz->KLCD', X_bbbb, t1_xa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('LxCD,Kyxz,ywuv,zuwv->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('LxCD,Kyxz,zwuv,yuwv->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('LxCD,Kyzw,xuvw,yuvz->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('LxCD,Kyzw,xuvz,yuwv->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('LxCD,Kyzw,xuyv,zwuv->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('LxCD,Kyzw,xwuv,yvzu->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('LxCD,Kyzw,xwuz,yu->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('LxCD,Kyzw,xzuv,yvwu->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('LxCD,Kyzw,xzuw,yu->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('LxCD,Kyzx,ywuv,zuwv->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('LxCD,Kyzx,zwuv,yuwv->KLCD', X_bbbb, t1_xaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb = sigma_KLCD_bbbb[:, :, ee_tril_ind[0], ee_tril_ind[1]]
    sigma[ccee__bbbb] += ascontiguousarray(sigma_KLCD_bbbb[cc_tril_ind[0], cc_tril_ind[1]]).reshape(-1)

    mr_adc.log.timer_debug("computing sigma H1 h1-h1 CCEE-CAEE", *cput1)

# CAEE <- CAEE
def compute_sigma_vector__H1__h1_h1__CAEE_CAEE(mr_adc, X_aaaa, X_abab, X_baba, X_bbbb, sigma):
    cput1 = (logger.process_clock(), logger.perf_counter())

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    #Excitation Manifold
    caee__aaaa = mr_adc.h1.caee__aaaa
    caee__abab = mr_adc.h1.caee__abab
    caee__baba = mr_adc.h1.caee__baba
    caee__bbbb = mr_adc.h1.caee__bbbb 

    ## Indices
    ee_tril_ind = mr_adc.h1.ee_tril_ind 

    ## Molecular Orbitals Energies
    e_cvs = mr_adc.mo_energy.x
    
    ## Two-electron integrals
    v_xxee = mr_adc.v2e.xxee
    v_xxaa = mr_adc.v2e.xxaa
    v_xaax = mr_adc.v2e.xaax
    v_xeex = mr_adc.v2e.xeex
    v_aaee = mr_adc.v2e.aaee
    v_aeea = mr_adc.v2e.aeea
#    v_eeee = mr_adc.v2e.eeee

    # Reduced Density Matrices
    rdm_ca = mr_adc.rdm.ca
    rdm_ccaa = mr_adc.rdm.ccaa

    # Variables from kernel
    ncvs    = mr_adc.ncvs
    ncas    = mr_adc.ncas
    nextern = mr_adc.nextern

    sigma_KWCD_aaaa =- 1/6 * einsum('KxCa,yDaz,Wzxy->KWCD', X_aaaa, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_aaaa += 1/6 * einsum('KxCa,yDaz,Wzyx->KWCD', X_aaaa, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_aaaa += 1/2 * einsum('KxCa,yzDa,Wyxz->KWCD', X_aaaa, v_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_aaaa += 1/6 * einsum('KxDa,yCaz,Wzxy->KWCD', X_aaaa, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_aaaa -= 1/6 * einsum('KxDa,yCaz,Wzyx->KWCD', X_aaaa, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_aaaa -= 1/2 * einsum('KxDa,yzCa,Wyxz->KWCD', X_aaaa, v_aaee, rdm_ccaa, optimize = einsum_type)
#    sigma_KWCD_aaaa += 1/4 * einsum('Kxab,CaDb,Wx->KWCD', X_aaaa, v_eeee, rdm_ca, optimize = einsum_type)
#    sigma_KWCD_aaaa -= 1/4 * einsum('Kxab,CbDa,Wx->KWCD', X_aaaa, v_eeee, rdm_ca, optimize = einsum_type)
    sigma_KWCD_aaaa -= 1/2 * einsum('ixCD,Kiyz,Wzxy->KWCD', X_aaaa, v_xxaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_aaaa += 1/6 * einsum('ixCD,Kyzi,Wyxz->KWCD', X_aaaa, v_xaax, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_aaaa -= 1/6 * einsum('ixCD,Kyzi,Wyzx->KWCD', X_aaaa, v_xaax, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_aaaa += 1/2 * einsum('ixCa,KDai,Wx->KWCD', X_aaaa, v_xeex, rdm_ca, optimize = einsum_type)
    sigma_KWCD_aaaa -= 1/2 * einsum('ixCa,iKDa,Wx->KWCD', X_aaaa, v_xxee, rdm_ca, optimize = einsum_type)
    sigma_KWCD_aaaa -= 1/2 * einsum('ixDa,KCai,Wx->KWCD', X_aaaa, v_xeex, rdm_ca, optimize = einsum_type)
    sigma_KWCD_aaaa += 1/2 * einsum('ixDa,iKCa,Wx->KWCD', X_aaaa, v_xxee, rdm_ca, optimize = einsum_type)
    sigma_KWCD_aaaa += 1/6 * einsum('KxCa,yDaz,Wzxy->KWCD', X_abab, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_aaaa += 1/3 * einsum('KxCa,yDaz,Wzyx->KWCD', X_abab, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_aaaa -= 1/6 * einsum('KxDa,yCaz,Wzxy->KWCD', X_abab, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_aaaa -= 1/3 * einsum('KxDa,yCaz,Wzyx->KWCD', X_abab, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_aaaa -= 1/2 * einsum('ixaC,KDai,Wx->KWCD', X_baba, v_xeex, rdm_ca, optimize = einsum_type)
    sigma_KWCD_aaaa += 1/2 * einsum('ixaD,KCai,Wx->KWCD', X_baba, v_xeex, rdm_ca, optimize = einsum_type)
    sigma_KWCD_aaaa += 1/4 * einsum('KxCa,yDaz,zy,Wx->KWCD', X_aaaa, v_aeea, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_aaaa -= 1/2 * einsum('KxCa,yzDa,yz,Wx->KWCD', X_aaaa, v_aaee, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_aaaa -= 1/4 * einsum('KxDa,yCaz,zy,Wx->KWCD', X_aaaa, v_aeea, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_aaaa += 1/2 * einsum('KxDa,yzCa,yz,Wx->KWCD', X_aaaa, v_aaee, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_aaaa += 1/2 * einsum('ixCD,Kiyz,yz,Wx->KWCD', X_aaaa, v_xxaa, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_aaaa -= 1/4 * einsum('ixCD,Kyzi,zy,Wx->KWCD', X_aaaa, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
#    sigma[caee__aaaa] += ascontiguousarray(sigma_KWCD_aaaa[:, :, ee_tril_ind[0], ee_tril_ind[1]]).reshape(-1)

    sigma_KWCD_abab  = 1/6 * einsum('KxCa,yDaz,Wzxy->KWCD', X_aaaa, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_abab += 1/3 * einsum('KxCa,yDaz,Wzyx->KWCD', X_aaaa, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_abab -= 1/6 * einsum('KxCa,yDaz,Wzxy->KWCD', X_abab, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_abab += 1/6 * einsum('KxCa,yDaz,Wzyx->KWCD', X_abab, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_abab += 1/2 * einsum('KxCa,yzDa,Wyxz->KWCD', X_abab, v_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_abab -= 1/3 * einsum('KxaD,yCaz,Wzxy->KWCD', X_abab, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_abab -= 1/6 * einsum('KxaD,yCaz,Wzyx->KWCD', X_abab, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_abab += 1/2 * einsum('KxaD,yzCa,Wyxz->KWCD', X_abab, v_aaee, rdm_ccaa, optimize = einsum_type)
#    sigma_KWCD_abab += 1/2 * einsum('Kxab,CaDb,Wx->KWCD', X_abab, v_eeee, rdm_ca, optimize = einsum_type)
    sigma_KWCD_abab -= 1/2 * einsum('ixCD,Kiyz,Wzxy->KWCD', X_abab, v_xxaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_abab += 1/3 * einsum('ixCD,Kyzi,Wyxz->KWCD', X_abab, v_xaax, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_abab += 1/6 * einsum('ixCD,Kyzi,Wyzx->KWCD', X_abab, v_xaax, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_abab -= 1/2 * einsum('ixCa,iKDa,Wx->KWCD', X_abab, v_xxee, rdm_ca, optimize = einsum_type)
    sigma_KWCD_abab += 1/2 * einsum('ixaD,KCai,Wx->KWCD', X_abab, v_xeex, rdm_ca, optimize = einsum_type)
    sigma_KWCD_abab -= 1/2 * einsum('ixaD,iKCa,Wx->KWCD', X_abab, v_xxee, rdm_ca, optimize = einsum_type)
    sigma_KWCD_abab += 1/6 * einsum('ixDC,Kyzi,Wyxz->KWCD', X_baba, v_xaax, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_abab += 1/3 * einsum('ixDC,Kyzi,Wyzx->KWCD', X_baba, v_xaax, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_abab -= 1/2 * einsum('ixDa,KCai,Wx->KWCD', X_bbbb, v_xeex, rdm_ca, optimize = einsum_type)
    sigma_KWCD_abab += 1/4 * einsum('KxCa,yDaz,zy,Wx->KWCD', X_abab, v_aeea, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_abab -= 1/2 * einsum('KxCa,yzDa,yz,Wx->KWCD', X_abab, v_aaee, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_abab += 1/4 * einsum('KxaD,yCaz,zy,Wx->KWCD', X_abab, v_aeea, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_abab -= 1/2 * einsum('KxaD,yzCa,yz,Wx->KWCD', X_abab, v_aaee, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_abab += 1/2 * einsum('ixCD,Kiyz,yz,Wx->KWCD', X_abab, v_xxaa, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_abab -= 1/4 * einsum('ixCD,Kyzi,zy,Wx->KWCD', X_abab, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
#    sigma[caee__abab] += ascontiguousarray(sigma_KWCD_abab).reshape(-1)

    sigma_KWCD_baba =- 1/2 * einsum('ixDa,KCai,Wx->KWCD', X_aaaa, v_xeex, rdm_ca, optimize = einsum_type)
    sigma_KWCD_baba += 1/6 * einsum('ixDC,Kyzi,Wyxz->KWCD', X_abab, v_xaax, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_baba += 1/3 * einsum('ixDC,Kyzi,Wyzx->KWCD', X_abab, v_xaax, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_baba -= 1/6 * einsum('KxCa,yDaz,Wzxy->KWCD', X_baba, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_baba += 1/6 * einsum('KxCa,yDaz,Wzyx->KWCD', X_baba, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_baba += 1/2 * einsum('KxCa,yzDa,Wyxz->KWCD', X_baba, v_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_baba -= 1/3 * einsum('KxaD,yCaz,Wzxy->KWCD', X_baba, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_baba -= 1/6 * einsum('KxaD,yCaz,Wzyx->KWCD', X_baba, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_baba += 1/2 * einsum('KxaD,yzCa,Wyxz->KWCD', X_baba, v_aaee, rdm_ccaa, optimize = einsum_type)
#    sigma_KWCD_baba += 1/2 * einsum('Kxab,CaDb,Wx->KWCD', X_baba, v_eeee, rdm_ca, optimize = einsum_type)
    sigma_KWCD_baba -= 1/2 * einsum('ixCD,Kiyz,Wzxy->KWCD', X_baba, v_xxaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_baba += 1/3 * einsum('ixCD,Kyzi,Wyxz->KWCD', X_baba, v_xaax, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_baba += 1/6 * einsum('ixCD,Kyzi,Wyzx->KWCD', X_baba, v_xaax, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_baba -= 1/2 * einsum('ixCa,iKDa,Wx->KWCD', X_baba, v_xxee, rdm_ca, optimize = einsum_type)
    sigma_KWCD_baba += 1/2 * einsum('ixaD,KCai,Wx->KWCD', X_baba, v_xeex, rdm_ca, optimize = einsum_type)
    sigma_KWCD_baba -= 1/2 * einsum('ixaD,iKCa,Wx->KWCD', X_baba, v_xxee, rdm_ca, optimize = einsum_type)
    sigma_KWCD_baba += 1/6 * einsum('KxCa,yDaz,Wzxy->KWCD', X_bbbb, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_baba += 1/3 * einsum('KxCa,yDaz,Wzyx->KWCD', X_bbbb, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_baba += 1/4 * einsum('KxCa,yDaz,zy,Wx->KWCD', X_baba, v_aeea, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_baba -= 1/2 * einsum('KxCa,yzDa,yz,Wx->KWCD', X_baba, v_aaee, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_baba += 1/4 * einsum('KxaD,yCaz,zy,Wx->KWCD', X_baba, v_aeea, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_baba -= 1/2 * einsum('KxaD,yzCa,yz,Wx->KWCD', X_baba, v_aaee, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_baba += 1/2 * einsum('ixCD,Kiyz,yz,Wx->KWCD', X_baba, v_xxaa, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_baba -= 1/4 * einsum('ixCD,Kyzi,zy,Wx->KWCD', X_baba, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
#    sigma[caee__baba] += ascontiguousarray(sigma_KWCD_baba).reshape(-1)

    sigma_KWCD_bbbb =- 1/2 * einsum('ixaC,KDai,Wx->KWCD', X_abab, v_xeex, rdm_ca, optimize = einsum_type)
    sigma_KWCD_bbbb += 1/2 * einsum('ixaD,KCai,Wx->KWCD', X_abab, v_xeex, rdm_ca, optimize = einsum_type)
    sigma_KWCD_bbbb += 1/6 * einsum('KxCa,yDaz,Wzxy->KWCD', X_baba, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_bbbb += 1/3 * einsum('KxCa,yDaz,Wzyx->KWCD', X_baba, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_bbbb -= 1/6 * einsum('KxDa,yCaz,Wzxy->KWCD', X_baba, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_bbbb -= 1/3 * einsum('KxDa,yCaz,Wzyx->KWCD', X_baba, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_bbbb -= 1/6 * einsum('KxCa,yDaz,Wzxy->KWCD', X_bbbb, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_bbbb += 1/6 * einsum('KxCa,yDaz,Wzyx->KWCD', X_bbbb, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_bbbb += 1/2 * einsum('KxCa,yzDa,Wyxz->KWCD', X_bbbb, v_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_bbbb += 1/6 * einsum('KxDa,yCaz,Wzxy->KWCD', X_bbbb, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_bbbb -= 1/6 * einsum('KxDa,yCaz,Wzyx->KWCD', X_bbbb, v_aeea, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_bbbb -= 1/2 * einsum('KxDa,yzCa,Wyxz->KWCD', X_bbbb, v_aaee, rdm_ccaa, optimize = einsum_type)
#    sigma_KWCD_bbbb += 1/4 * einsum('Kxab,CaDb,Wx->KWCD', X_bbbb, v_eeee, rdm_ca, optimize = einsum_type)
#    sigma_KWCD_bbbb -= 1/4 * einsum('Kxab,CbDa,Wx->KWCD', X_bbbb, v_eeee, rdm_ca, optimize = einsum_type)
    sigma_KWCD_bbbb -= 1/2 * einsum('ixCD,Kiyz,Wzxy->KWCD', X_bbbb, v_xxaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_bbbb += 1/6 * einsum('ixCD,Kyzi,Wyxz->KWCD', X_bbbb, v_xaax, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_bbbb -= 1/6 * einsum('ixCD,Kyzi,Wyzx->KWCD', X_bbbb, v_xaax, rdm_ccaa, optimize = einsum_type)
    sigma_KWCD_bbbb += 1/2 * einsum('ixCa,KDai,Wx->KWCD', X_bbbb, v_xeex, rdm_ca, optimize = einsum_type)
    sigma_KWCD_bbbb -= 1/2 * einsum('ixCa,iKDa,Wx->KWCD', X_bbbb, v_xxee, rdm_ca, optimize = einsum_type)
    sigma_KWCD_bbbb -= 1/2 * einsum('ixDa,KCai,Wx->KWCD', X_bbbb, v_xeex, rdm_ca, optimize = einsum_type)
    sigma_KWCD_bbbb += 1/2 * einsum('ixDa,iKCa,Wx->KWCD', X_bbbb, v_xxee, rdm_ca, optimize = einsum_type)
    sigma_KWCD_bbbb += 1/4 * einsum('KxCa,yDaz,zy,Wx->KWCD', X_bbbb, v_aeea, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_bbbb -= 1/2 * einsum('KxCa,yzDa,yz,Wx->KWCD', X_bbbb, v_aaee, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_bbbb -= 1/4 * einsum('KxDa,yCaz,zy,Wx->KWCD', X_bbbb, v_aeea, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_bbbb += 1/2 * einsum('KxDa,yzCa,yz,Wx->KWCD', X_bbbb, v_aaee, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_bbbb += 1/2 * einsum('ixCD,Kiyz,yz,Wx->KWCD', X_bbbb, v_xxaa, rdm_ca, rdm_ca, optimize = einsum_type)
    sigma_KWCD_bbbb -= 1/4 * einsum('ixCD,Kyzi,zy,Wx->KWCD', X_bbbb, v_xaax, rdm_ca, rdm_ca, optimize = einsum_type)
#    sigma[caee__bbbb] += ascontiguousarray(sigma_KWCD_bbbb[:, :, ee_tril_ind[0], ee_tril_ind[1]]).reshape(-1)

    chunks = tools.calculate_chunks(mr_adc, nextern, [nextern, nextern, nextern])
    for i_chunk, (s_chunk, f_chunk) in enumerate(chunks):
        cput2 = (logger.process_clock(), logger.perf_counter())
        mr_adc.log.debug("v2e.eeee [%i/%i], chunk [%i:%i]", i_chunk + 1, len(chunks), s_chunk, f_chunk)
    
        ## Two-electron integral
        v_eeee = mr_adc.v2e.eeee[:, :, s_chunk:f_chunk]

        temp  = 1/4 * einsum('Kxab,CaDb,Wx->KWCD', X_aaaa, v_eeee, rdm_ca, optimize = einsum_type)
        temp -= 1/4 * einsum('Kxab,CbDa,Wx->KWCD', X_aaaa, v_eeee, rdm_ca, optimize = einsum_type)
        sigma_KWCD_aaaa[:, :, :, s_chunk:f_chunk] += temp

        temp  = 1/2 * einsum('Kxab,CaDb,Wx->KWCD', X_abab, v_eeee, rdm_ca, optimize = einsum_type)
        sigma_KWCD_abab[:, :, :, s_chunk:f_chunk] += temp

        temp  = 1/2 * einsum('Kxab,CaDb,Wx->KWCD', X_baba, v_eeee, rdm_ca, optimize = einsum_type)
        sigma_KWCD_baba[:, :, :, s_chunk:f_chunk] += temp

        temp  = 1/4 * einsum('Kxab,CaDb,Wx->KWCD', X_bbbb, v_eeee, rdm_ca, optimize = einsum_type)
        temp -= 1/4 * einsum('Kxab,CbDa,Wx->KWCD', X_bbbb, v_eeee, rdm_ca, optimize = einsum_type)
        sigma_KWCD_bbbb[:, :, :, s_chunk:f_chunk] += temp

        mr_adc.log.timer_debug("contracting v2e.eeee", *cput2)
    del(v_eeee)

    sigma[caee__aaaa] += ascontiguousarray(sigma_KWCD_aaaa[:, :, ee_tril_ind[0], ee_tril_ind[1]]).reshape(-1)
    sigma[caee__abab] += ascontiguousarray(sigma_KWCD_abab).reshape(-1)
    sigma[caee__baba] += ascontiguousarray(sigma_KWCD_baba).reshape(-1)
    sigma[caee__bbbb] += ascontiguousarray(sigma_KWCD_bbbb[:, :, ee_tril_ind[0], ee_tril_ind[1]]).reshape(-1)

    mr_adc.log.timer_debug("computing sigma H1 h1-h1 CAEE-CAEE", *cput1)

# CAAA <- CAEE
def compute_sigma_vector__H1__h1_h1__CAAA_CAEE(mr_adc, X_aaaa, X_abab, X_baba, X_bbbb, sigma):
    cput1 = (logger.process_clock(), logger.perf_counter())

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    #Excitation Manifold
    caaa__aaaa = mr_adc.h1.caaa__aaaa
    caaa__abab = mr_adc.h1.caaa__abab
    caaa__baba = mr_adc.h1.caaa__baba
    caaa__bbbb = mr_adc.h1.caaa__bbbb 

    ## Indices
    aa_tril_ind = mr_adc.h1.aa_tril_ind 

    ## Molecular Orbitals Energies
    e_extern = mr_adc.mo_energy.e

    ## One-electron integrals
    h_aa = mr_adc.h1eff.aa

    ## Two-electron integrals
    v_aeae = mr_adc.v2e.aeae
    v_aaaa = mr_adc.v2e.aaaa
  
    ## Amplitudes
    t1_aaee = mr_adc.t1.aaee
  
    # Reduced Density Matrices
    rdm_ca = mr_adc.rdm.ca
    rdm_ccaa = mr_adc.rdm.ccaa
    rdm_cccaaa = mr_adc.rdm.cccaaa

    sigma_KWUV_aaaa  = 1/4 * einsum('Kxab,UaVb,Wx->KWUV', X_aaaa, v_aeae, rdm_ca, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Uayb,VxWy->KWUV', X_aaaa, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Uayb,VxyW->KWUV', X_aaaa, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/4 * einsum('Kxab,UbVa,Wx->KWUV', X_aaaa, v_aeae, rdm_ca, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Ubya,VxWy->KWUV', X_aaaa, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Ubya,VxyW->KWUV', X_aaaa, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Vayb,UxWy->KWUV', X_aaaa, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Vayb,UxyW->KWUV', X_aaaa, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Vbya,UxWy->KWUV', X_aaaa, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Vbya,UxyW->KWUV', X_aaaa, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/3 * einsum('Kxab,Uayb,VxWy->KWUV', X_abab, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,Uayb,VxyW->KWUV', X_abab, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/3 * einsum('Kxab,Vayb,UxWy->KWUV', X_abab, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,Vayb,UxyW->KWUV', X_abab, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/2 * einsum('Kxab,b,UVab,Wx->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/2 * einsum('Kxab,b,UVba,Wx->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,b,Uyab,VxWy->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,b,Uyab,VxyW->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,b,Uyba,VxWy->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,b,Uyba,VxyW->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,b,Vyab,UxWy->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,b,Vyab,UxyW->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,b,Vyba,UxWy->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,b,Vyba,UxyW->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/4 * einsum('Kxab,Uy,Vyab,Wx->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/4 * einsum('Kxab,Uy,Vyba,Wx->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Uy,yzab,VxWz->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Uy,yzab,VxzW->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Uy,zyab,VxWz->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Uy,zyab,VxzW->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/4 * einsum('Kxab,Vy,Uyab,Wx->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/4 * einsum('Kxab,Vy,Uyba,Wx->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Vy,yzab,UxWz->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Vy,yzab,UxzW->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Vy,zyab,UxWz->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Vy,zyab,UxzW->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yz,Uyab,VxWz->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yz,Uyab,VxzW->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yz,Uyba,VxWz->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yz,Uyba,VxzW->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yz,Vyab,UxWz->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yz,Vyab,UxzW->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yz,Vyba,UxWz->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yz,Vyba,UxzW->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/4 * einsum('Kxab,Uyab,Vyzw,Wzxw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Uyab,Vzwy,Wwxz->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Uyab,Vzwy,Wwzx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Uyab,yzwu,VxwWzu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Uyab,yzwu,VxwzWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/4 * einsum('Kxab,Uyba,Vyzw,Wzxw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Uyba,Vzwy,Wwxz->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Uyba,Vzwy,Wwzx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Uyba,yzwu,VxwWzu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Uyba,yzwu,VxwzWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/4 * einsum('Kxab,Vyab,Uyzw,Wzxw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Vyab,Uzwy,Wwxz->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Vyab,Uzwy,Wwzx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Vyab,yzwu,UxwWzu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Vyab,yzwu,UxwzWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/4 * einsum('Kxab,Vyba,Uyzw,Wzxw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Vyba,Uzwy,Wwxz->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Vyba,Uzwy,Wwzx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,Vyba,yzwu,UxwWzu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,Vyba,yzwu,UxwzWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,UwVy,Wzwx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,UwVy,Wzxw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,UwVz,Wywx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,UwVz,Wyxw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/24 * einsum('Kxab,yzab,Uwuy,VxwWuz->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/24 * einsum('Kxab,yzab,Uwuy,VxwuzW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/24 * einsum('Kxab,yzab,Uwuy,VxwzWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/24 * einsum('Kxab,yzab,Uwuz,VxwWuy->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/24 * einsum('Kxab,yzab,Uwuz,VxwuyW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/24 * einsum('Kxab,yzab,Uwuz,VxwyWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,UyVw,Wzwx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,UyVw,Wzxw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/4 * einsum('Kxab,yzab,UyVz,Wx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Uywu,VxuWzw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Uywu,VxuzWw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Uywz,VxWw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Uywz,VxwW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,UzVw,Wywx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,UzVw,Wyxw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/4 * einsum('Kxab,yzab,UzVy,Wx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Uzwu,VxuWyw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Uzwu,VxuyWw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Uzwy,VxWw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Uzwy,VxwW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/24 * einsum('Kxab,yzab,Vwuy,UxwWuz->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/24 * einsum('Kxab,yzab,Vwuy,UxwuzW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/24 * einsum('Kxab,yzab,Vwuy,UxwzWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/24 * einsum('Kxab,yzab,Vwuz,UxwWuy->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/24 * einsum('Kxab,yzab,Vwuz,UxwuyW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/24 * einsum('Kxab,yzab,Vwuz,UxwyWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Vywu,UxuWzw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Vywu,UxuzWw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Vywz,UxWw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Vywz,UxwW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Vzwu,UxuWyw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Vzwu,UxuyWw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Vzwy,UxWw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Vzwy,UxwW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/24 * einsum('Kxab,yzab,Wwyu,UVxuwz->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/24 * einsum('Kxab,yzab,Wwyu,UVxwzu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/24 * einsum('Kxab,yzab,Wwyu,UVxzuw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/24 * einsum('Kxab,yzab,Wwzu,UVxuwy->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/24 * einsum('Kxab,yzab,Wwzu,UVxwyu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/24 * einsum('Kxab,yzab,Wwzu,UVxyuw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/3 * einsum('Kxab,a,Uyab,VxWy->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,a,Uyab,VxyW->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/3 * einsum('Kxab,a,Vyab,UxWy->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,a,Vyab,UxyW->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/3 * einsum('Kxab,b,Uyab,VxWy->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,b,Uyab,VxyW->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/3 * einsum('Kxab,b,Vyab,UxWy->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,b,Vyab,UxyW->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/3 * einsum('Kxab,Uy,yzab,VxWz->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,Uy,yzab,VxzW->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/3 * einsum('Kxab,Vy,yzab,UxWz->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,Vy,yzab,UxzW->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/3 * einsum('Kxab,yz,Uyab,VxWz->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,yz,Uyab,VxzW->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/3 * einsum('Kxab,yz,Vyab,UxWz->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,yz,Vyab,UxzW->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,Uyab,Vzwy,Wwxz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/3 * einsum('Kxab,Uyab,Vzwy,Wwzx->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/3 * einsum('Kxab,Uyab,yzwu,VxwWzu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,Uyab,yzwu,VxwzWu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,Vyab,Uzwy,Wwxz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/3 * einsum('Kxab,Vyab,Uzwy,Wwzx->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/3 * einsum('Kxab,Vyab,yzwu,UxwWzu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,Vyab,yzwu,UxwzWu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/3 * einsum('Kxab,yzab,UwVy,Wzwx->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,yzab,UwVy,Wzxw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Uwuy,VxwWuz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,yzab,Uwuy,VxwWzu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Uwuy,VxwuzW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Uwuy,VxwzWu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Uwuz,VxwWuy->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Uwuz,VxwuyW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Uwuz,VxwyWu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,yzab,Uwuz,VxwyuW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/3 * einsum('Kxab,yzab,UyVw,Wzwx->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,yzab,UyVw,Wzxw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/3 * einsum('Kxab,yzab,Uywu,VxuWzw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,yzab,Uywu,VxuzWw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/3 * einsum('Kxab,yzab,Uywz,VxWw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,yzab,Uywz,VxwW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Vwuy,UxwWuz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,yzab,Vwuy,UxwWzu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Vwuy,UxwuzW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Vwuy,UxwzWu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Vwuz,UxwWuy->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Vwuz,UxwuyW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Vwuz,UxwyWu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,yzab,Vwuz,UxwyuW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/3 * einsum('Kxab,yzab,Vywu,UxuWzw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,yzab,Vywu,UxuzWw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/3 * einsum('Kxab,yzab,Vywz,UxWw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,yzab,Vywz,UxwW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Wwyu,UVxuwz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/6 * einsum('Kxab,yzab,Wwyu,UVxwuz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Wwyu,UVxwzu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Wwyu,UVxzuw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Wwzu,UVxuwy->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa += 1/12 * einsum('Kxab,yzab,Wwzu,UVxwyu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/12 * einsum('Kxab,yzab,Wwzu,UVxyuw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_aaaa -= 1/6 * einsum('Kxab,yzab,Wwzu,UVxywu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[caaa__aaaa] += ascontiguousarray(sigma_KWUV_aaaa[:, :, aa_tril_ind[0], aa_tril_ind[1]]).reshape(-1)

    sigma_KWUV_abab  = 1/6 * einsum('Kxab,Uayb,VxWy->KWUV', X_aaaa, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,Uayb,VxyW->KWUV', X_aaaa, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Ubya,VxWy->KWUV', X_aaaa, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,Ubya,VxyW->KWUV', X_aaaa, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/2 * einsum('Kxab,UaVb,Wx->KWUV', X_abab, v_aeae, rdm_ca, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,Uayb,VxWy->KWUV', X_abab, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Uayb,VxyW->KWUV', X_abab, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Vbya,UxWy->KWUV', X_abab, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/3 * einsum('Kxab,Vbya,UxyW->KWUV', X_abab, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/3 * einsum('Kxab,b,Uyab,VxWy->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,b,Uyab,VxyW->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/3 * einsum('Kxab,b,Uyba,VxWy->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,b,Uyba,VxyW->KWUV', X_aaaa, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Uy,yzab,VxWz->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,Uy,yzab,VxzW->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,Uy,zyab,VxWz->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,Uy,zyab,VxzW->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yz,Uyab,VxWz->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yz,Uyab,VxzW->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yz,Uyba,VxWz->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yz,Uyba,VxzW->KWUV', X_aaaa, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,Uyab,Vzwy,Wwxz->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Uyab,Vzwy,Wwzx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Uyab,yzwu,VxwWzu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,Uyab,yzwu,VxwzWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,Uyba,Vzwy,Wwxz->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,Uyba,Vzwy,Wwzx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,Uyba,yzwu,VxwWzu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,Uyba,yzwu,VxwzWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/24 * einsum('Kxab,yzab,Uwuy,VxwWuz->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Uwuy,VxwWzu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/24 * einsum('Kxab,yzab,Uwuy,VxwuzW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/24 * einsum('Kxab,yzab,Uwuy,VxwzWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/24 * einsum('Kxab,yzab,Uwuz,VxwWuy->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Uwuz,VxwWyu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/24 * einsum('Kxab,yzab,Uwuz,VxwuyW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/24 * einsum('Kxab,yzab,Uwuz,VxwyWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,UyVw,Wzwx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,UyVw,Wzxw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,Uywu,VxuWzw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Uywu,VxuzWw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,Uywz,VxWw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Uywz,VxwW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yzab,UzVw,Wywx->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,UzVw,Wyxw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yzab,Uzwu,VxuWyw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Uzwu,VxuyWw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yzab,Uzwy,VxWw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Uzwy,VxwW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/24 * einsum('Kxab,yzab,Vwuy,UxwWuz->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/24 * einsum('Kxab,yzab,Vwuy,UxwuzW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/24 * einsum('Kxab,yzab,Vwuy,UxwzWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Vwuy,UxwzuW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/24 * einsum('Kxab,yzab,Vwuz,UxwWuy->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/24 * einsum('Kxab,yzab,Vwuz,UxwuyW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/24 * einsum('Kxab,yzab,Vwuz,UxwyWu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Vwuz,UxwyuW->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/24 * einsum('Kxab,yzab,Wwyu,UVxuwz->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/24 * einsum('Kxab,yzab,Wwyu,UVxwzu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/24 * einsum('Kxab,yzab,Wwyu,UVxzuw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Wwyu,UVxzwu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/24 * einsum('Kxab,yzab,Wwzu,UVxuwy->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/24 * einsum('Kxab,yzab,Wwzu,UVxwyu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/24 * einsum('Kxab,yzab,Wwzu,UVxyuw->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Wwzu,UVxywu->KWUV', X_aaaa, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/2 * einsum('Kxab,a,UVab,Wx->KWUV', X_abab, e_extern, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,a,Uyab,VxWy->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,a,Uyab,VxyW->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,a,Vyba,UxWy->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/3 * einsum('Kxab,a,Vyba,UxyW->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/2 * einsum('Kxab,b,UVab,Wx->KWUV', X_abab, e_extern, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,b,Uyab,VxWy->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,b,Uyab,VxyW->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,b,Vyba,UxWy->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/3 * einsum('Kxab,b,Vyba,UxyW->KWUV', X_abab, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/2 * einsum('Kxab,Uy,Vyba,Wx->KWUV', X_abab, h_aa, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Uy,yzab,VxWz->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,Uy,yzab,VxzW->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/2 * einsum('Kxab,Vy,Uyab,Wx->KWUV', X_abab, h_aa, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,Vy,zyab,UxWz->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/3 * einsum('Kxab,Vy,zyab,UxzW->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yz,Uyab,VxWz->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yz,Uyab,VxzW->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yz,Vyba,UxWz->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/3 * einsum('Kxab,yz,Vyba,UxzW->KWUV', X_abab, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/2 * einsum('Kxab,Uyab,Vyzw,Wzxw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,Uyab,Vzwy,Wwxz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Uyab,Vzwy,Wwzx->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Uyab,yzwu,VxwWzu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,Uyab,yzwu,VxwzWu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/2 * einsum('Kxab,Vyba,Uyzw,Wzxw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/3 * einsum('Kxab,Vyba,Uzwy,Wwxz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,Vyba,Uzwy,Wwzx->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Vyba,yzwu,UxwWuz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Vyba,yzwu,UxwuWz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Vyba,yzwu,UxwuzW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,Vyba,yzwu,UxwzWu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,Vyba,yzwu,UxwzuW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yzab,UwVz,Wywx->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/3 * einsum('Kxab,yzab,UwVz,Wyxw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Uwuy,VxwWuz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yzab,Uwuy,VxwWzu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Uwuy,VxwuzW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Uwuy,VxwzWu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Uwuz,VxwWuy->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,Uwuz,VxwuWy->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Uwuz,VxwuyW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Uwuz,VxwyWu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,UyVw,Wzwx->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yzab,UyVw,Wzxw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/2 * einsum('Kxab,yzab,UyVz,Wx->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,Uywu,VxuWzw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yzab,Uywu,VxuzWw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,Uywz,VxWw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yzab,Uywz,VxwW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Vwuy,UxwWuz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,Vwuy,UxwuWz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Vwuy,UxwuzW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Vwuy,UxwzWu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Vwuz,UxwWuy->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Vwuz,UxwuyW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Vwuz,UxwyWu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yzab,Vwuz,UxwyuW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,Vzwu,UxuWwy->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,Vzwu,UxuwWy->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,Vzwu,UxuwyW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yzab,Vzwu,UxuyWw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,Vzwu,UxuywW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yzab,Vzwy,UxWw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/3 * einsum('Kxab,yzab,Vzwy,UxwW->KWUV', X_abab, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Wwyu,UVxuwz->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/6 * einsum('Kxab,yzab,Wwyu,UVxuzw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Wwyu,UVxwzu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Wwyu,UVxzuw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Wwzu,UVxuwy->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/12 * einsum('Kxab,yzab,Wwzu,UVxwyu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab += 1/12 * einsum('Kxab,yzab,Wwzu,UVxyuw->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_abab -= 1/6 * einsum('Kxab,yzab,Wwzu,UVxywu->KWUV', X_abab, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[caaa__abab] += ascontiguousarray(sigma_KWUV_abab).reshape(-1)

    sigma_KWUV_baba  = 1/2 * einsum('Kxab,UaVb,Wx->KWUV', X_baba, v_aeae, rdm_ca, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,Uayb,VxWy->KWUV', X_baba, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Uayb,VxyW->KWUV', X_baba, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Vbya,UxWy->KWUV', X_baba, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/3 * einsum('Kxab,Vbya,UxyW->KWUV', X_baba, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,Uayb,VxWy->KWUV', X_bbbb, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,Uayb,VxyW->KWUV', X_bbbb, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Ubya,VxWy->KWUV', X_bbbb, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,Ubya,VxyW->KWUV', X_bbbb, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/2 * einsum('Kxab,a,UVab,Wx->KWUV', X_baba, e_extern, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,a,Uyab,VxWy->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,a,Uyab,VxyW->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,a,Vyba,UxWy->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/3 * einsum('Kxab,a,Vyba,UxyW->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/2 * einsum('Kxab,b,UVab,Wx->KWUV', X_baba, e_extern, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,b,Uyab,VxWy->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,b,Uyab,VxyW->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,b,Vyba,UxWy->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/3 * einsum('Kxab,b,Vyba,UxyW->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/2 * einsum('Kxab,Uy,Vyba,Wx->KWUV', X_baba, h_aa, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Uy,yzab,VxWz->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,Uy,yzab,VxzW->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/2 * einsum('Kxab,Vy,Uyab,Wx->KWUV', X_baba, h_aa, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,Vy,zyab,UxWz->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/3 * einsum('Kxab,Vy,zyab,UxzW->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yz,Uyab,VxWz->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yz,Uyab,VxzW->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yz,Vyba,UxWz->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/3 * einsum('Kxab,yz,Vyba,UxzW->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/2 * einsum('Kxab,Uyab,Vyzw,Wzxw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,Uyab,Vzwy,Wwxz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Uyab,Vzwy,Wwzx->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Uyab,yzwu,VxwWzu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,Uyab,yzwu,VxwzWu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/2 * einsum('Kxab,Vyba,Uyzw,Wzxw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/3 * einsum('Kxab,Vyba,Uzwy,Wwxz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,Vyba,Uzwy,Wwzx->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Vyba,yzwu,UxwWuz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Vyba,yzwu,UxwuWz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Vyba,yzwu,UxwuzW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,Vyba,yzwu,UxwzWu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Vyba,yzwu,UxwzuW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yzab,UwVz,Wywx->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/3 * einsum('Kxab,yzab,UwVz,Wyxw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Uwuy,VxwWuz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yzab,Uwuy,VxwWzu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Uwuy,VxwuzW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Uwuy,VxwzWu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Uwuz,VxwWuy->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,Uwuz,VxwuWy->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Uwuz,VxwuyW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Uwuz,VxwyWu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,UyVw,Wzwx->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yzab,UyVw,Wzxw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/2 * einsum('Kxab,yzab,UyVz,Wx->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,Uywu,VxuWzw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yzab,Uywu,VxuzWw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,Uywz,VxWw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yzab,Uywz,VxwW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Vwuy,UxwWuz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,Vwuy,UxwuWz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Vwuy,UxwuzW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Vwuy,UxwzWu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Vwuz,UxwWuy->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Vwuz,UxwuyW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Vwuz,UxwyWu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yzab,Vwuz,UxwyuW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,Vzwu,UxuWwy->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,Vzwu,UxuwWy->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,Vzwu,UxuwyW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yzab,Vzwu,UxuyWw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,Vzwu,UxuywW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yzab,Vzwy,UxWw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/3 * einsum('Kxab,yzab,Vzwy,UxwW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Wwyu,UVxuwz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yzab,Wwyu,UVxuzw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Wwyu,UVxwzu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Wwyu,UVxzuw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Wwzu,UVxuwy->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Wwzu,UVxwyu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Wwzu,UVxyuw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,Wwzu,UVxywu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/3 * einsum('Kxab,b,Uyab,VxWy->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,b,Uyab,VxyW->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/3 * einsum('Kxab,b,Uyba,VxWy->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,b,Uyba,VxyW->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Uy,yzab,VxWz->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,Uy,yzab,VxzW->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,Uy,zyab,VxWz->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,Uy,zyab,VxzW->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yz,Uyab,VxWz->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yz,Uyab,VxzW->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yz,Uyba,VxWz->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yz,Uyba,VxzW->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,Uyab,Vzwy,Wwxz->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Uyab,Vzwy,Wwzx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,Uyab,yzwu,VxwWzu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,Uyab,yzwu,VxwzWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,Uyba,Vzwy,Wwxz->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,Uyba,Vzwy,Wwzx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,Uyba,yzwu,VxwWzu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,Uyba,yzwu,VxwzWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/24 * einsum('Kxab,yzab,Uwuy,VxwWuz->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Uwuy,VxwWzu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/24 * einsum('Kxab,yzab,Uwuy,VxwuzW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/24 * einsum('Kxab,yzab,Uwuy,VxwzWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/24 * einsum('Kxab,yzab,Uwuz,VxwWuy->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Uwuz,VxwWyu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/24 * einsum('Kxab,yzab,Uwuz,VxwuyW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/24 * einsum('Kxab,yzab,Uwuz,VxwyWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,UyVw,Wzwx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,UyVw,Wzxw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,Uywu,VxuWzw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Uywu,VxuzWw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/6 * einsum('Kxab,yzab,Uywz,VxWw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Uywz,VxwW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yzab,UzVw,Wywx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,UzVw,Wyxw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yzab,Uzwu,VxuWyw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Uzwu,VxuyWw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/6 * einsum('Kxab,yzab,Uzwy,VxWw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Uzwy,VxwW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/24 * einsum('Kxab,yzab,Vwuy,UxwWuz->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/24 * einsum('Kxab,yzab,Vwuy,UxwuzW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/24 * einsum('Kxab,yzab,Vwuy,UxwzWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Vwuy,UxwzuW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/24 * einsum('Kxab,yzab,Vwuz,UxwWuy->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/24 * einsum('Kxab,yzab,Vwuz,UxwuyW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/24 * einsum('Kxab,yzab,Vwuz,UxwyWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Vwuz,UxwyuW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/24 * einsum('Kxab,yzab,Wwyu,UVxuwz->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/24 * einsum('Kxab,yzab,Wwyu,UVxwzu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/24 * einsum('Kxab,yzab,Wwyu,UVxzuw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/12 * einsum('Kxab,yzab,Wwyu,UVxzwu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba += 1/24 * einsum('Kxab,yzab,Wwzu,UVxuwy->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/24 * einsum('Kxab,yzab,Wwzu,UVxwyu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/24 * einsum('Kxab,yzab,Wwzu,UVxyuw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_baba -= 1/12 * einsum('Kxab,yzab,Wwzu,UVxywu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[caaa__baba] += ascontiguousarray(sigma_KWUV_baba).reshape(-1)

    sigma_KWUV_bbbb  = 1/3 * einsum('Kxab,Uayb,VxWy->KWUV', X_baba, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,Uayb,VxyW->KWUV', X_baba, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/3 * einsum('Kxab,Vayb,UxWy->KWUV', X_baba, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,Vayb,UxyW->KWUV', X_baba, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/4 * einsum('Kxab,UaVb,Wx->KWUV', X_bbbb, v_aeae, rdm_ca, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Uayb,VxWy->KWUV', X_bbbb, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Uayb,VxyW->KWUV', X_bbbb, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/4 * einsum('Kxab,UbVa,Wx->KWUV', X_bbbb, v_aeae, rdm_ca, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Ubya,VxWy->KWUV', X_bbbb, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Ubya,VxyW->KWUV', X_bbbb, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Vayb,UxWy->KWUV', X_bbbb, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Vayb,UxyW->KWUV', X_bbbb, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Vbya,UxWy->KWUV', X_bbbb, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Vbya,UxyW->KWUV', X_bbbb, v_aeae, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/3 * einsum('Kxab,a,Uyab,VxWy->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,a,Uyab,VxyW->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/3 * einsum('Kxab,a,Vyab,UxWy->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,a,Vyab,UxyW->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/3 * einsum('Kxab,b,Uyab,VxWy->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,b,Uyab,VxyW->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/3 * einsum('Kxab,b,Vyab,UxWy->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,b,Vyab,UxyW->KWUV', X_baba, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/3 * einsum('Kxab,Uy,yzab,VxWz->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,Uy,yzab,VxzW->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/3 * einsum('Kxab,Vy,yzab,UxWz->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,Vy,yzab,UxzW->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/3 * einsum('Kxab,yz,Uyab,VxWz->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,yz,Uyab,VxzW->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/3 * einsum('Kxab,yz,Vyab,UxWz->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,yz,Vyab,UxzW->KWUV', X_baba, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,Uyab,Vzwy,Wwxz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/3 * einsum('Kxab,Uyab,Vzwy,Wwzx->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/3 * einsum('Kxab,Uyab,yzwu,VxwWzu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,Uyab,yzwu,VxwzWu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,Vyab,Uzwy,Wwxz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/3 * einsum('Kxab,Vyab,Uzwy,Wwzx->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/3 * einsum('Kxab,Vyab,yzwu,UxwWzu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,Vyab,yzwu,UxwzWu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/3 * einsum('Kxab,yzab,UwVy,Wzwx->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,yzab,UwVy,Wzxw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Uwuy,VxwWuz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,yzab,Uwuy,VxwWzu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Uwuy,VxwuzW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Uwuy,VxwzWu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Uwuz,VxwWuy->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Uwuz,VxwuyW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Uwuz,VxwyWu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,yzab,Uwuz,VxwyuW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/3 * einsum('Kxab,yzab,UyVw,Wzwx->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,yzab,UyVw,Wzxw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/3 * einsum('Kxab,yzab,Uywu,VxuWzw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,yzab,Uywu,VxuzWw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/3 * einsum('Kxab,yzab,Uywz,VxWw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,yzab,Uywz,VxwW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Vwuy,UxwWuz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,yzab,Vwuy,UxwWzu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Vwuy,UxwuzW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Vwuy,UxwzWu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Vwuz,UxwWuy->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Vwuz,UxwuyW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Vwuz,UxwyWu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,yzab,Vwuz,UxwyuW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/3 * einsum('Kxab,yzab,Vywu,UxuWzw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,yzab,Vywu,UxuzWw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/3 * einsum('Kxab,yzab,Vywz,UxWw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,yzab,Vywz,UxwW->KWUV', X_baba, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Wwyu,UVxuwz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,yzab,Wwyu,UVxwuz->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Wwyu,UVxwzu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Wwyu,UVxzuw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Wwzu,UVxuwy->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Wwzu,UVxwyu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Wwzu,UVxyuw->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,yzab,Wwzu,UVxywu->KWUV', X_baba, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/2 * einsum('Kxab,b,UVab,Wx->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/2 * einsum('Kxab,b,UVba,Wx->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,b,Uyab,VxWy->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,b,Uyab,VxyW->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,b,Uyba,VxWy->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,b,Uyba,VxyW->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,b,Vyab,UxWy->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,b,Vyab,UxyW->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/6 * einsum('Kxab,b,Vyba,UxWy->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/6 * einsum('Kxab,b,Vyba,UxyW->KWUV', X_bbbb, e_extern, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/4 * einsum('Kxab,Uy,Vyab,Wx->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/4 * einsum('Kxab,Uy,Vyba,Wx->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Uy,yzab,VxWz->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Uy,yzab,VxzW->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Uy,zyab,VxWz->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Uy,zyab,VxzW->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/4 * einsum('Kxab,Vy,Uyab,Wx->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/4 * einsum('Kxab,Vy,Uyba,Wx->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ca, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Vy,yzab,UxWz->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Vy,yzab,UxzW->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Vy,zyab,UxWz->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Vy,zyab,UxzW->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yz,Uyab,VxWz->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yz,Uyab,VxzW->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yz,Uyba,VxWz->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yz,Uyba,VxzW->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yz,Vyab,UxWz->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yz,Vyab,UxzW->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yz,Vyba,UxWz->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yz,Vyba,UxzW->KWUV', X_bbbb, h_aa, t1_aaee, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/4 * einsum('Kxab,Uyab,Vyzw,Wzxw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Uyab,Vzwy,Wwxz->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Uyab,Vzwy,Wwzx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Uyab,yzwu,VxwWzu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Uyab,yzwu,VxwzWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/4 * einsum('Kxab,Uyba,Vyzw,Wzxw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Uyba,Vzwy,Wwxz->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Uyba,Vzwy,Wwzx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Uyba,yzwu,VxwWzu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Uyba,yzwu,VxwzWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/4 * einsum('Kxab,Vyab,Uyzw,Wzxw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Vyab,Uzwy,Wwxz->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Vyab,Uzwy,Wwzx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Vyab,yzwu,UxwWzu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Vyab,yzwu,UxwzWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/4 * einsum('Kxab,Vyba,Uyzw,Wzxw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Vyba,Uzwy,Wwxz->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Vyba,Uzwy,Wwzx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,Vyba,yzwu,UxwWzu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,Vyba,yzwu,UxwzWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,UwVy,Wzwx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,UwVy,Wzxw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,UwVz,Wywx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,UwVz,Wyxw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/24 * einsum('Kxab,yzab,Uwuy,VxwWuz->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/24 * einsum('Kxab,yzab,Uwuy,VxwuzW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/24 * einsum('Kxab,yzab,Uwuy,VxwzWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/24 * einsum('Kxab,yzab,Uwuz,VxwWuy->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/24 * einsum('Kxab,yzab,Uwuz,VxwuyW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/24 * einsum('Kxab,yzab,Uwuz,VxwyWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,UyVw,Wzwx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,UyVw,Wzxw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/4 * einsum('Kxab,yzab,UyVz,Wx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Uywu,VxuWzw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Uywu,VxuzWw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Uywz,VxWw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Uywz,VxwW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,UzVw,Wywx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,UzVw,Wyxw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/4 * einsum('Kxab,yzab,UzVy,Wx->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Uzwu,VxuWyw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Uzwu,VxuyWw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Uzwy,VxWw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Uzwy,VxwW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/24 * einsum('Kxab,yzab,Vwuy,UxwWuz->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/24 * einsum('Kxab,yzab,Vwuy,UxwuzW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/24 * einsum('Kxab,yzab,Vwuy,UxwzWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/24 * einsum('Kxab,yzab,Vwuz,UxwWuy->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/24 * einsum('Kxab,yzab,Vwuz,UxwuyW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/24 * einsum('Kxab,yzab,Vwuz,UxwyWu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Vywu,UxuWzw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Vywu,UxuzWw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Vywz,UxWw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Vywz,UxwW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Vzwu,UxuWyw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Vzwu,UxuyWw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/12 * einsum('Kxab,yzab,Vzwy,UxWw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/12 * einsum('Kxab,yzab,Vzwy,UxwW->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/24 * einsum('Kxab,yzab,Wwyu,UVxuwz->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/24 * einsum('Kxab,yzab,Wwyu,UVxwzu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb -= 1/24 * einsum('Kxab,yzab,Wwyu,UVxzuw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/24 * einsum('Kxab,yzab,Wwzu,UVxuwy->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/24 * einsum('Kxab,yzab,Wwzu,UVxwyu->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWUV_bbbb += 1/24 * einsum('Kxab,yzab,Wwzu,UVxyuw->KWUV', X_bbbb, t1_aaee, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[caaa__bbbb] += ascontiguousarray(sigma_KWUV_bbbb[:, :, aa_tril_ind[0], aa_tril_ind[1]]).reshape(-1)

    mr_adc.log.timer_debug("computing sigma H1 h1-h1 CAAA-CAEE", *cput1)

# CAEA <- CAEE
def compute_sigma_vector__H1__h1_h1__CAEA_CAEE(mr_adc, X_aaaa, X_abab, X_baba, X_bbbb, sigma):
    cput1 = (logger.process_clock(), logger.perf_counter())

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    #Excitation Manifold
    caea__aaaa = mr_adc.h1.caea__aaaa
    caea__abab = mr_adc.h1.caea__abab
    caea__baab = mr_adc.h1.caea__baab
    caea__bbbb = mr_adc.h1.caea__bbbb
    caea__baba = mr_adc.h1.caea__baba
    caea__abba = mr_adc.h1.caea__abba 

    ## Molecular Orbitals Energies
    e_extern = mr_adc.mo_energy.e
 
    ## One-electron integrals
    h_aa = mr_adc.h1eff.aa
    h_ae = mr_adc.h1eff.ae
 
    ## Two-electron integrals
    v_xxae = mr_adc.v2e.xxae
    v_xaex = mr_adc.v2e.xaex
    v_aaaa = mr_adc.v2e.aaaa
    v_aaae = mr_adc.v2e.aaae
    v_aeee = mr_adc.v2e.aeee
  
    ## Amplitudes
    t1_ae = mr_adc.t1.ae
    t1_aaae = mr_adc.t1.aaae
    
    # Reduced Density Matrices
    rdm_ca = mr_adc.rdm.ca
    rdm_ccaa = mr_adc.rdm.ccaa
    rdm_cccaaa = mr_adc.rdm.cccaaa

    sigma_KWCU_aaaa  = 1/2 * einsum('KxCa,Ua,Wx->KWCU', X_aaaa, h_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,Uyza,Wzxy->KWCU', X_aaaa, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,Uyza,Wzyx->KWCU', X_aaaa, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yWza,Uxyz->KWCU', X_aaaa, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yWza,Uxzy->KWCU', X_aaaa, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/2 * einsum('KxCa,yzUa,Wyxz->KWCU', X_aaaa, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/4 * einsum('Kxab,UaCb,Wx->KWCU', X_aaaa, v_aeee, rdm_ca, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/4 * einsum('Kxab,UbCa,Wx->KWCU', X_aaaa, v_aeee, rdm_ca, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/12 * einsum('Kxab,yaCb,UxWy->KWCU', X_aaaa, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/12 * einsum('Kxab,yaCb,UxyW->KWCU', X_aaaa, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/12 * einsum('Kxab,ybCa,UxWy->KWCU', X_aaaa, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/12 * einsum('Kxab,ybCa,UxyW->KWCU', X_aaaa, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/2 * einsum('ixCa,KUai,Wx->KWCU', X_aaaa, v_xaex, rdm_ca, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('ixCa,Kyai,UxWy->KWCU', X_aaaa, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('ixCa,Kyai,UxyW->KWCU', X_aaaa, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/2 * einsum('ixCa,iKUa,Wx->KWCU', X_aaaa, v_xxae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('ixCa,iKya,UxWy->KWCU', X_aaaa, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('ixCa,iKya,UxyW->KWCU', X_aaaa, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,Uyza,Wzxy->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/3 * einsum('KxCa,Uyza,Wzyx->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/3 * einsum('KxCa,yWza,Uxyz->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yWza,Uxzy->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/3 * einsum('Kxab,ybCa,UxWy->KWCU', X_abab, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('Kxab,ybCa,UxyW->KWCU', X_abab, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/3 * einsum('ixCa,iKya,UxWy->KWCU', X_abab, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('ixCa,iKya,UxyW->KWCU', X_abab, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/2 * einsum('ixaC,KUai,Wx->KWCU', X_baba, v_xaex, rdm_ca, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('ixaC,Kyai,UxWy->KWCU', X_baba, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('ixaC,Kyai,UxyW->KWCU', X_baba, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/2 * einsum('KxCa,a,Ua,Wx->KWCU', X_aaaa, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,a,Uyza,Wyxz->KWCU', X_aaaa, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,a,Uyza,Wyzx->KWCU', X_aaaa, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/2 * einsum('KxCa,a,yUza,Wyxz->KWCU', X_aaaa, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,a,yzWa,Uxyz->KWCU', X_aaaa, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,a,yzWa,Uxzy->KWCU', X_aaaa, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/2 * einsum('KxCa,Uy,ya,Wx->KWCU', X_aaaa, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,Uy,yzwa,Wzwx->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,Uy,yzwa,Wzxw->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/2 * einsum('KxCa,Uy,zywa,Wzxw->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,Wy,zwya,Uxwz->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,Wy,zwya,Uxzw->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yz,Uwya,Wwxz->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yz,Uwya,Wwzx->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yz,Uywa,Wzwx->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yz,Uywa,Wzxw->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/2 * einsum('KxCa,yz,wUya,Wwxz->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yz,wyWa,Uxwz->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yz,wyWa,Uxzw->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/2 * einsum('KxCa,yz,yUwa,Wzxw->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yz,ywWa,Uxwz->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yz,ywWa,Uxzw->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvxzu->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,Uyza,ywuv,Wwvzxu->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,Uyza,zwuv,Wyuwxv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuxwv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/2 * einsum('KxCa,yUza,ywuv,Wwvxzu->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/2 * einsum('KxCa,yUza,zwuv,Wyuxwv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/2 * einsum('KxCa,ya,Uyzw,Wzxw->KWCU', X_aaaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,ya,Uzwy,Wwxz->KWCU', X_aaaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,ya,Uzwy,Wwzx->KWCU', X_aaaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,ya,Wzyw,Uxwz->KWCU', X_aaaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,ya,Wzyw,Uxzw->KWCU', X_aaaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzWa,ywuv,Uxuwzv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuzwv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzWa,ywzu,Uxuw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzWa,ywzu,Uxwu->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzWa,zwuv,Uxuwyv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzWa,zwuv,Uxuywv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uuvy,Wzvuxw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uuvy,Wzvxuw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvuwx->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvxwu->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyuxv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyxuv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuwxv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuxwv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uyuz,Wuwx->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uyuz,Wuxw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/2 * einsum('KxCa,yzwa,Uzuv,Wyuxwv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/2 * einsum('KxCa,yzwa,Uzuy,Wuxw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Wuvw,Uxvuzy->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Wuvw,Uxvzuy->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwuzv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwzuv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Wuzv,Uxwuvy->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Wuzv,Uxwvuy->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuyzv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuzyv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,a,Uyza,Wyxz->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/3 * einsum('KxCa,a,Uyza,Wyzx->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/3 * einsum('KxCa,a,yzWa,Uxyz->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,a,yzWa,Uxzy->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/3 * einsum('KxCa,Uy,yzwa,Wzwx->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,Uy,yzwa,Wzxw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,Wy,zwya,Uxwz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/3 * einsum('KxCa,Wy,zwya,Uxzw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yz,Uwya,Wwxz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/3 * einsum('KxCa,yz,Uwya,Wwzx->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/3 * einsum('KxCa,yz,Uywa,Wzwx->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yz,Uywa,Wzxw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/3 * einsum('KxCa,yz,wyWa,Uxwz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yz,wyWa,Uxzw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yz,ywWa,Uxwz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/3 * einsum('KxCa,yz,ywWa,Uxzw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvuxz->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvuzx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvxuz->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvzux->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,Uyza,ywuv,Wwvzxu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuvwx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuvxw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuwvx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,Uyza,zwuv,Wyuwxv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuxvw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,ya,Uzwy,Wwxz->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/3 * einsum('KxCa,ya,Uzwy,Wwzx->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,ya,Wzyw,Uxwz->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/3 * einsum('KxCa,ya,Wzyw,Uxzw->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuvwz->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuvzw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuwvz->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzWa,ywuv,Uxuwzv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuzvw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzWa,ywzu,Uxuw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/3 * einsum('KxCa,yzWa,ywzu,Uxwu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzWa,zwuv,Uxuwyv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/3 * einsum('KxCa,yzWa,zwuv,Uxuywv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/3 * einsum('KxCa,yzwa,Uuvy,Wzvuxw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uuvy,Wzvxuw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvuwx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvuxw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvwux->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvwxu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvxuw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyuvx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyuxv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyvux->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyvxu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyxvu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuvwx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuvxw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuwvx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuwxv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuxvw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/3 * einsum('KxCa,yzwa,Uyuz,Wuwx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Uyuz,Wuxw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/3 * einsum('KxCa,yzwa,Wuvw,Uxvuzy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Wuvw,Uxvzuy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwuvz->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwuzv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwvuz->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwvzu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwzvu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/3 * einsum('KxCa,yzwa,Wuzv,Uxwuvy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Wuzv,Uxwvuy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuvyz->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuvzy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuyvz->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa -= 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuyzv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_aaaa += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuzvy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[caea__aaaa] += ascontiguousarray(sigma_KWCU_aaaa).reshape(-1)

    sigma_KWCU_abab  = 1/6 * einsum('KxCa,Uyza,Wzxy->KWCU', X_aaaa, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/3 * einsum('KxCa,Uyza,Wzyx->KWCU', X_aaaa, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/3 * einsum('KxCa,yWza,Uxyz->KWCU', X_aaaa, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yWza,Uxzy->KWCU', X_aaaa, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('Kxab,yaCb,UxWy->KWCU', X_aaaa, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/12 * einsum('Kxab,yaCb,UxyW->KWCU', X_aaaa, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('Kxab,ybCa,UxWy->KWCU', X_aaaa, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/12 * einsum('Kxab,ybCa,UxyW->KWCU', X_aaaa, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/3 * einsum('ixCa,Kyai,UxWy->KWCU', X_aaaa, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('ixCa,Kyai,UxyW->KWCU', X_aaaa, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/3 * einsum('ixCa,iKya,UxWy->KWCU', X_aaaa, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('ixCa,iKya,UxyW->KWCU', X_aaaa, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/2 * einsum('KxCa,Ua,Wx->KWCU', X_abab, h_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,Uyza,Wzxy->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,Uyza,Wzyx->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yWza,Uxyz->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yWza,Uxzy->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/2 * einsum('KxCa,yzUa,Wyxz->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/2 * einsum('Kxab,UbCa,Wx->KWCU', X_abab, v_aeee, rdm_ca, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('Kxab,ybCa,UxWy->KWCU', X_abab, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('Kxab,ybCa,UxyW->KWCU', X_abab, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/2 * einsum('ixCa,iKUa,Wx->KWCU', X_abab, v_xxae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('ixCa,iKya,UxWy->KWCU', X_abab, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('ixCa,iKya,UxyW->KWCU', X_abab, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/3 * einsum('ixaC,Kyai,UxWy->KWCU', X_baba, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('ixaC,Kyai,UxyW->KWCU', X_baba, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,a,Uyza,Wyxz->KWCU', X_aaaa, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/3 * einsum('KxCa,a,Uyza,Wyzx->KWCU', X_aaaa, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/3 * einsum('KxCa,a,yzWa,Uxyz->KWCU', X_aaaa, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,a,yzWa,Uxzy->KWCU', X_aaaa, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/3 * einsum('KxCa,Uy,yzwa,Wzwx->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,Uy,yzwa,Wzxw->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,Wy,zwya,Uxwz->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/3 * einsum('KxCa,Wy,zwya,Uxzw->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yz,Uwya,Wwxz->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/3 * einsum('KxCa,yz,Uwya,Wwzx->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/3 * einsum('KxCa,yz,Uywa,Wzwx->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yz,Uywa,Wzxw->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/3 * einsum('KxCa,yz,wyWa,Uxwz->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yz,wyWa,Uxzw->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yz,ywWa,Uxwz->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/3 * einsum('KxCa,yz,ywWa,Uxzw->KWCU', X_aaaa, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvuxz->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvuzx->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvxuz->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvzux->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,Uyza,ywuv,Wwvzxu->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuvwx->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuvxw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuwvx->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,Uyza,zwuv,Wyuwxv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuxvw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,ya,Uzwy,Wwxz->KWCU', X_aaaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/3 * einsum('KxCa,ya,Uzwy,Wwzx->KWCU', X_aaaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,ya,Wzyw,Uxwz->KWCU', X_aaaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/3 * einsum('KxCa,ya,Wzyw,Uxzw->KWCU', X_aaaa, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuvwz->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuvzw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuwvz->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzWa,ywuv,Uxuwzv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuzvw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzWa,ywzu,Uxuw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/3 * einsum('KxCa,yzWa,ywzu,Uxwu->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzWa,zwuv,Uxuwyv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/3 * einsum('KxCa,yzWa,zwuv,Uxuywv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/3 * einsum('KxCa,yzwa,Uuvy,Wzvuxw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uuvy,Wzvxuw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvuwx->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvuxw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvwux->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvwxu->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvxuw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyuvx->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyuxv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyvux->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyvxu->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyxvu->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuvwx->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuvxw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuwvx->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuwxv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuxvw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/3 * einsum('KxCa,yzwa,Uyuz,Wuwx->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uyuz,Wuxw->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/3 * einsum('KxCa,yzwa,Wuvw,Uxvuzy->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Wuvw,Uxvzuy->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwuvz->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwuzv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwvuz->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwvzu->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwzvu->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/3 * einsum('KxCa,yzwa,Wuzv,Uxwuvy->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Wuzv,Uxwvuy->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuvyz->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuvzy->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuyvz->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuyzv->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuzvy->KWCU', X_aaaa, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/2 * einsum('KxCa,a,Ua,Wx->KWCU', X_abab, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,a,Uyza,Wyxz->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,a,Uyza,Wyzx->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/2 * einsum('KxCa,a,yUza,Wyxz->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,a,yzWa,Uxyz->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,a,yzWa,Uxzy->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/2 * einsum('KxCa,Uy,ya,Wx->KWCU', X_abab, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,Uy,yzwa,Wzwx->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,Uy,yzwa,Wzxw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/2 * einsum('KxCa,Uy,zywa,Wzxw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,Wy,zwya,Uxwz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,Wy,zwya,Uxzw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yz,Uwya,Wwxz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yz,Uwya,Wwzx->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yz,Uywa,Wzwx->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yz,Uywa,Wzxw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/2 * einsum('KxCa,yz,wUya,Wwxz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yz,wyWa,Uxwz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yz,wyWa,Uxzw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/2 * einsum('KxCa,yz,yUwa,Wzxw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yz,ywWa,Uxwz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yz,ywWa,Uxzw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvxzu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,Uyza,ywuv,Wwvzxu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,Uyza,zwuv,Wyuwxv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuxwv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/2 * einsum('KxCa,yUza,ywuv,Wwvxzu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/2 * einsum('KxCa,yUza,zwuv,Wyuxwv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/2 * einsum('KxCa,ya,Uyzw,Wzxw->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,ya,Uzwy,Wwxz->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,ya,Uzwy,Wwzx->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,ya,Wzyw,Uxwz->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,ya,Wzyw,Uxzw->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzWa,ywuv,Uxuwzv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuzwv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzWa,ywzu,Uxuw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzWa,ywzu,Uxwu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzWa,zwuv,Uxuwyv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzWa,zwuv,Uxuywv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uuvy,Wzvuxw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uuvy,Wzvxuw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvuwx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvxwu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyuxv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyxuv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuwxv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuxwv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Uyuz,Wuwx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Uyuz,Wuxw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/2 * einsum('KxCa,yzwa,Uzuv,Wyuxwv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/2 * einsum('KxCa,yzwa,Uzuy,Wuxw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Wuvw,Uxvuzy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Wuvw,Uxvzuy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwuzv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwzuv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Wuzv,Uxwuvy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Wuzv,Uxwvuy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab -= 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuyzv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abab += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuzyv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[caea__abab] += ascontiguousarray(sigma_KWCU_abab).reshape(-1)

    sigma_KWCU_abba =- 1/2 * einsum('KxaC,Ua,Wx->KWCU', X_abab, h_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('KxaC,Uyza,Wzxy->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,Uyza,Wzyx->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yWza,Uxyz->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('KxaC,yWza,Uxzy->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/2 * einsum('KxaC,yzUa,Wyxz->KWCU', X_abab, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/2 * einsum('Kxab,UaCb,Wx->KWCU', X_abab, v_aeee, rdm_ca, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('Kxab,yaCb,UxWy->KWCU', X_abab, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('Kxab,yaCb,UxyW->KWCU', X_abab, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/2 * einsum('ixaC,KUai,Wx->KWCU', X_abab, v_xaex, rdm_ca, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('ixaC,Kyai,UxWy->KWCU', X_abab, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('ixaC,Kyai,UxyW->KWCU', X_abab, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/2 * einsum('ixaC,iKUa,Wx->KWCU', X_abab, v_xxae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('ixaC,iKya,UxWy->KWCU', X_abab, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('ixaC,iKya,UxyW->KWCU', X_abab, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/2 * einsum('ixCa,KUai,Wx->KWCU', X_bbbb, v_xaex, rdm_ca, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('ixCa,Kyai,UxWy->KWCU', X_bbbb, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('ixCa,Kyai,UxyW->KWCU', X_bbbb, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/2 * einsum('KxaC,a,Ua,Wx->KWCU', X_abab, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('KxaC,a,Uyza,Wyxz->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,a,Uyza,Wyzx->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/2 * einsum('KxaC,a,yUza,Wyxz->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,a,yzWa,Uxyz->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('KxaC,a,yzWa,Uxzy->KWCU', X_abab, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/2 * einsum('KxaC,Uy,ya,Wx->KWCU', X_abab, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,Uy,yzwa,Wzwx->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('KxaC,Uy,yzwa,Wzxw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/2 * einsum('KxaC,Uy,zywa,Wzxw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('KxaC,Wy,zwya,Uxwz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,Wy,zwya,Uxzw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('KxaC,yz,Uwya,Wwxz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yz,Uwya,Wwzx->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yz,Uywa,Wzwx->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('KxaC,yz,Uywa,Wzxw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/2 * einsum('KxaC,yz,wUya,Wwxz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yz,wyWa,Uxwz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('KxaC,yz,wyWa,Uxzw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/2 * einsum('KxaC,yz,yUwa,Wzxw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('KxaC,yz,ywWa,Uxwz->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yz,ywWa,Uxzw->KWCU', X_abab, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('KxaC,Uyza,ywuv,Wwvxzu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,Uyza,ywuv,Wwvzxu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,Uyza,zwuv,Wyuwxv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('KxaC,Uyza,zwuv,Wyuxwv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/2 * einsum('KxaC,yUza,ywuv,Wwvxzu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/2 * einsum('KxaC,yUza,zwuv,Wyuxwv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/2 * einsum('KxaC,ya,Uyzw,Wzxw->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('KxaC,ya,Uzwy,Wwxz->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,ya,Uzwy,Wwzx->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('KxaC,ya,Wzyw,Uxwz->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,ya,Wzyw,Uxzw->KWCU', X_abab, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzWa,ywuv,Uxuwzv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('KxaC,yzWa,ywuv,Uxuzwv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('KxaC,yzWa,ywzu,Uxuw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzWa,ywzu,Uxwu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzWa,zwuv,Uxuvwy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzWa,zwuv,Uxuvyw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzWa,zwuv,Uxuwvy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzWa,zwuv,Uxuwyv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzWa,zwuv,Uxuyvw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzwa,Uuvy,Wzvuwx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzwa,Uuvy,Wzvwux->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzwa,Uuvy,Wzvwxu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzwa,Uuvy,Wzvxuw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzwa,Uuvy,Wzvxwu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzwa,Uuvz,Wyvuwx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('KxaC,yzwa,Uuvz,Wyvxwu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzwa,Uuwv,Wzyuxv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('KxaC,yzwa,Uuwv,Wzyxuv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzwa,Uyuv,Wzuwxv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('KxaC,yzwa,Uyuv,Wzuxwv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzwa,Uyuz,Wuwx->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('KxaC,yzwa,Uyuz,Wuxw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/2 * einsum('KxaC,yzwa,Uzuv,Wyuxwv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/2 * einsum('KxaC,yzwa,Uzuy,Wuxw->KWCU', X_abab, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzwa,Wuvw,Uxvuyz->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzwa,Wuvw,Uxvyuz->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzwa,Wuvw,Uxvyzu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzwa,Wuvw,Uxvzuy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzwa,Wuvw,Uxvzyu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzwa,Wuyv,Uxwuzv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/3 * einsum('KxaC,yzwa,Wuyv,Uxwzuv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzwa,Wuzv,Uxwuyv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba += 1/6 * einsum('KxaC,yzwa,Wuzv,Uxwvuy->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzwa,Wuzv,Uxwvyu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzwa,Wuzv,Uxwyuv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzwa,Wuzv,Uxwyvu->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/6 * einsum('KxaC,yzwa,Wwuv,Uxuyzv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_abba -= 1/3 * einsum('KxaC,yzwa,Wwuv,Uxuzyv->KWCU', X_abab, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[caea__abba] += ascontiguousarray(sigma_KWCU_abba).reshape(-1)

    sigma_KWCU_baab  = 1/2 * einsum('ixCa,KUai,Wx->KWCU', X_aaaa, v_xaex, rdm_ca, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('ixCa,Kyai,UxWy->KWCU', X_aaaa, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('ixCa,Kyai,UxyW->KWCU', X_aaaa, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/2 * einsum('KxaC,Ua,Wx->KWCU', X_baba, h_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('KxaC,Uyza,Wzxy->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,Uyza,Wzyx->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yWza,Uxyz->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('KxaC,yWza,Uxzy->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/2 * einsum('KxaC,yzUa,Wyxz->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/2 * einsum('Kxab,UaCb,Wx->KWCU', X_baba, v_aeee, rdm_ca, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('Kxab,yaCb,UxWy->KWCU', X_baba, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('Kxab,yaCb,UxyW->KWCU', X_baba, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/2 * einsum('ixaC,KUai,Wx->KWCU', X_baba, v_xaex, rdm_ca, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('ixaC,Kyai,UxWy->KWCU', X_baba, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('ixaC,Kyai,UxyW->KWCU', X_baba, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/2 * einsum('ixaC,iKUa,Wx->KWCU', X_baba, v_xxae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('ixaC,iKya,UxWy->KWCU', X_baba, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('ixaC,iKya,UxyW->KWCU', X_baba, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/2 * einsum('KxaC,a,Ua,Wx->KWCU', X_baba, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('KxaC,a,Uyza,Wyxz->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,a,Uyza,Wyzx->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/2 * einsum('KxaC,a,yUza,Wyxz->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,a,yzWa,Uxyz->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('KxaC,a,yzWa,Uxzy->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/2 * einsum('KxaC,Uy,ya,Wx->KWCU', X_baba, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,Uy,yzwa,Wzwx->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('KxaC,Uy,yzwa,Wzxw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/2 * einsum('KxaC,Uy,zywa,Wzxw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('KxaC,Wy,zwya,Uxwz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,Wy,zwya,Uxzw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('KxaC,yz,Uwya,Wwxz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yz,Uwya,Wwzx->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yz,Uywa,Wzwx->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('KxaC,yz,Uywa,Wzxw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/2 * einsum('KxaC,yz,wUya,Wwxz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yz,wyWa,Uxwz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('KxaC,yz,wyWa,Uxzw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/2 * einsum('KxaC,yz,yUwa,Wzxw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('KxaC,yz,ywWa,Uxwz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yz,ywWa,Uxzw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('KxaC,Uyza,ywuv,Wwvxzu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,Uyza,ywuv,Wwvzxu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,Uyza,zwuv,Wyuwxv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('KxaC,Uyza,zwuv,Wyuxwv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/2 * einsum('KxaC,yUza,ywuv,Wwvxzu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/2 * einsum('KxaC,yUza,zwuv,Wyuxwv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/2 * einsum('KxaC,ya,Uyzw,Wzxw->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('KxaC,ya,Uzwy,Wwxz->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,ya,Uzwy,Wwzx->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('KxaC,ya,Wzyw,Uxwz->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,ya,Wzyw,Uxzw->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzWa,ywuv,Uxuwzv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('KxaC,yzWa,ywuv,Uxuzwv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('KxaC,yzWa,ywzu,Uxuw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzWa,ywzu,Uxwu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzWa,zwuv,Uxuvwy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzWa,zwuv,Uxuvyw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzWa,zwuv,Uxuwvy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzWa,zwuv,Uxuwyv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzWa,zwuv,Uxuyvw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzwa,Uuvy,Wzvuwx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzwa,Uuvy,Wzvwux->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzwa,Uuvy,Wzvwxu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzwa,Uuvy,Wzvxuw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzwa,Uuvy,Wzvxwu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzwa,Uuvz,Wyvuwx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('KxaC,yzwa,Uuvz,Wyvxwu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzwa,Uuwv,Wzyuxv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('KxaC,yzwa,Uuwv,Wzyxuv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzwa,Uyuv,Wzuwxv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('KxaC,yzwa,Uyuv,Wzuxwv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzwa,Uyuz,Wuwx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('KxaC,yzwa,Uyuz,Wuxw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/2 * einsum('KxaC,yzwa,Uzuv,Wyuxwv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/2 * einsum('KxaC,yzwa,Uzuy,Wuxw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzwa,Wuvw,Uxvuyz->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzwa,Wuvw,Uxvyuz->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzwa,Wuvw,Uxvyzu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzwa,Wuvw,Uxvzuy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzwa,Wuvw,Uxvzyu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzwa,Wuyv,Uxwuzv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/3 * einsum('KxaC,yzwa,Wuyv,Uxwzuv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzwa,Wuzv,Uxwuyv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab += 1/6 * einsum('KxaC,yzwa,Wuzv,Uxwvuy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzwa,Wuzv,Uxwvyu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzwa,Wuzv,Uxwyuv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzwa,Wuzv,Uxwyvu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/6 * einsum('KxaC,yzwa,Wwuv,Uxuyzv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baab -= 1/3 * einsum('KxaC,yzwa,Wwuv,Uxuzyv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[caea__baab] += ascontiguousarray(sigma_KWCU_baab).reshape(-1)

    sigma_KWCU_baba =- 1/3 * einsum('ixaC,Kyai,UxWy->KWCU', X_abab, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('ixaC,Kyai,UxyW->KWCU', X_abab, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/2 * einsum('KxCa,Ua,Wx->KWCU', X_baba, h_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,Uyza,Wzxy->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,Uyza,Wzyx->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yWza,Uxyz->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yWza,Uxzy->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/2 * einsum('KxCa,yzUa,Wyxz->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/2 * einsum('Kxab,UbCa,Wx->KWCU', X_baba, v_aeee, rdm_ca, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('Kxab,ybCa,UxWy->KWCU', X_baba, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('Kxab,ybCa,UxyW->KWCU', X_baba, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/2 * einsum('ixCa,iKUa,Wx->KWCU', X_baba, v_xxae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('ixCa,iKya,UxWy->KWCU', X_baba, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('ixCa,iKya,UxyW->KWCU', X_baba, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,Uyza,Wzxy->KWCU', X_bbbb, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/3 * einsum('KxCa,Uyza,Wzyx->KWCU', X_bbbb, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/3 * einsum('KxCa,yWza,Uxyz->KWCU', X_bbbb, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yWza,Uxzy->KWCU', X_bbbb, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('Kxab,yaCb,UxWy->KWCU', X_bbbb, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/12 * einsum('Kxab,yaCb,UxyW->KWCU', X_bbbb, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('Kxab,ybCa,UxWy->KWCU', X_bbbb, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/12 * einsum('Kxab,ybCa,UxyW->KWCU', X_bbbb, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/3 * einsum('ixCa,Kyai,UxWy->KWCU', X_bbbb, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('ixCa,Kyai,UxyW->KWCU', X_bbbb, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/3 * einsum('ixCa,iKya,UxWy->KWCU', X_bbbb, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('ixCa,iKya,UxyW->KWCU', X_bbbb, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/2 * einsum('KxCa,a,Ua,Wx->KWCU', X_baba, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,a,Uyza,Wyxz->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,a,Uyza,Wyzx->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/2 * einsum('KxCa,a,yUza,Wyxz->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,a,yzWa,Uxyz->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,a,yzWa,Uxzy->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/2 * einsum('KxCa,Uy,ya,Wx->KWCU', X_baba, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,Uy,yzwa,Wzwx->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,Uy,yzwa,Wzxw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/2 * einsum('KxCa,Uy,zywa,Wzxw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,Wy,zwya,Uxwz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,Wy,zwya,Uxzw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yz,Uwya,Wwxz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yz,Uwya,Wwzx->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yz,Uywa,Wzwx->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yz,Uywa,Wzxw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/2 * einsum('KxCa,yz,wUya,Wwxz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yz,wyWa,Uxwz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yz,wyWa,Uxzw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/2 * einsum('KxCa,yz,yUwa,Wzxw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yz,ywWa,Uxwz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yz,ywWa,Uxzw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvxzu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,Uyza,ywuv,Wwvzxu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,Uyza,zwuv,Wyuwxv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuxwv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/2 * einsum('KxCa,yUza,ywuv,Wwvxzu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/2 * einsum('KxCa,yUza,zwuv,Wyuxwv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/2 * einsum('KxCa,ya,Uyzw,Wzxw->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,ya,Uzwy,Wwxz->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,ya,Uzwy,Wwzx->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,ya,Wzyw,Uxwz->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,ya,Wzyw,Uxzw->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzWa,ywuv,Uxuwzv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuzwv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzWa,ywzu,Uxuw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzWa,ywzu,Uxwu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzWa,zwuv,Uxuwyv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzWa,zwuv,Uxuywv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uuvy,Wzvuxw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uuvy,Wzvxuw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvuwx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvxwu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyuxv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyxuv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuwxv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuxwv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uyuz,Wuwx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uyuz,Wuxw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/2 * einsum('KxCa,yzwa,Uzuv,Wyuxwv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/2 * einsum('KxCa,yzwa,Uzuy,Wuxw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Wuvw,Uxvuzy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Wuvw,Uxvzuy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwuzv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwzuv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Wuzv,Uxwuvy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Wuzv,Uxwvuy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuyzv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuzyv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,a,Uyza,Wyxz->KWCU', X_bbbb, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/3 * einsum('KxCa,a,Uyza,Wyzx->KWCU', X_bbbb, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/3 * einsum('KxCa,a,yzWa,Uxyz->KWCU', X_bbbb, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,a,yzWa,Uxzy->KWCU', X_bbbb, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/3 * einsum('KxCa,Uy,yzwa,Wzwx->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,Uy,yzwa,Wzxw->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,Wy,zwya,Uxwz->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/3 * einsum('KxCa,Wy,zwya,Uxzw->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yz,Uwya,Wwxz->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/3 * einsum('KxCa,yz,Uwya,Wwzx->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/3 * einsum('KxCa,yz,Uywa,Wzwx->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yz,Uywa,Wzxw->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/3 * einsum('KxCa,yz,wyWa,Uxwz->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yz,wyWa,Uxzw->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yz,ywWa,Uxwz->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/3 * einsum('KxCa,yz,ywWa,Uxzw->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvuxz->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvuzx->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvxuz->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvzux->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,Uyza,ywuv,Wwvzxu->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuvwx->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuvxw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuwvx->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,Uyza,zwuv,Wyuwxv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuxvw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,ya,Uzwy,Wwxz->KWCU', X_bbbb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/3 * einsum('KxCa,ya,Uzwy,Wwzx->KWCU', X_bbbb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,ya,Wzyw,Uxwz->KWCU', X_bbbb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/3 * einsum('KxCa,ya,Wzyw,Uxzw->KWCU', X_bbbb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuvwz->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuvzw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuwvz->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzWa,ywuv,Uxuwzv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuzvw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzWa,ywzu,Uxuw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/3 * einsum('KxCa,yzWa,ywzu,Uxwu->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzWa,zwuv,Uxuwyv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/3 * einsum('KxCa,yzWa,zwuv,Uxuywv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/3 * einsum('KxCa,yzwa,Uuvy,Wzvuxw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uuvy,Wzvxuw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvuwx->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvuxw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvwux->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvwxu->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvxuw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyuvx->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyuxv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyvux->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyvxu->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyxvu->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuvwx->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuvxw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuwvx->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuwxv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuxvw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/3 * einsum('KxCa,yzwa,Uyuz,Wuwx->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Uyuz,Wuxw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/3 * einsum('KxCa,yzwa,Wuvw,Uxvuzy->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Wuvw,Uxvzuy->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwuvz->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwuzv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwvuz->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwvzu->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwzvu->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/3 * einsum('KxCa,yzwa,Wuzv,Uxwuvy->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Wuzv,Uxwvuy->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuvyz->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuvzy->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuyvz->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba -= 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuyzv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_baba += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuzvy->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[caea__baba] += ascontiguousarray(sigma_KWCU_baba).reshape(-1)

    sigma_KWCU_bbbb =- 1/2 * einsum('ixaC,KUai,Wx->KWCU', X_abab, v_xaex, rdm_ca, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('ixaC,Kyai,UxWy->KWCU', X_abab, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('ixaC,Kyai,UxyW->KWCU', X_abab, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,Uyza,Wzxy->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/3 * einsum('KxCa,Uyza,Wzyx->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/3 * einsum('KxCa,yWza,Uxyz->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yWza,Uxzy->KWCU', X_baba, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/3 * einsum('Kxab,ybCa,UxWy->KWCU', X_baba, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('Kxab,ybCa,UxyW->KWCU', X_baba, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/3 * einsum('ixCa,iKya,UxWy->KWCU', X_baba, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('ixCa,iKya,UxyW->KWCU', X_baba, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/2 * einsum('KxCa,Ua,Wx->KWCU', X_bbbb, h_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,Uyza,Wzxy->KWCU', X_bbbb, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,Uyza,Wzyx->KWCU', X_bbbb, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yWza,Uxyz->KWCU', X_bbbb, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yWza,Uxzy->KWCU', X_bbbb, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/2 * einsum('KxCa,yzUa,Wyxz->KWCU', X_bbbb, v_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/4 * einsum('Kxab,UaCb,Wx->KWCU', X_bbbb, v_aeee, rdm_ca, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/4 * einsum('Kxab,UbCa,Wx->KWCU', X_bbbb, v_aeee, rdm_ca, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/12 * einsum('Kxab,yaCb,UxWy->KWCU', X_bbbb, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/12 * einsum('Kxab,yaCb,UxyW->KWCU', X_bbbb, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/12 * einsum('Kxab,ybCa,UxWy->KWCU', X_bbbb, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/12 * einsum('Kxab,ybCa,UxyW->KWCU', X_bbbb, v_aeee, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/2 * einsum('ixCa,KUai,Wx->KWCU', X_bbbb, v_xaex, rdm_ca, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('ixCa,Kyai,UxWy->KWCU', X_bbbb, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('ixCa,Kyai,UxyW->KWCU', X_bbbb, v_xaex, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/2 * einsum('ixCa,iKUa,Wx->KWCU', X_bbbb, v_xxae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('ixCa,iKya,UxWy->KWCU', X_bbbb, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('ixCa,iKya,UxyW->KWCU', X_bbbb, v_xxae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,a,Uyza,Wyxz->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/3 * einsum('KxCa,a,Uyza,Wyzx->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/3 * einsum('KxCa,a,yzWa,Uxyz->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,a,yzWa,Uxzy->KWCU', X_baba, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/3 * einsum('KxCa,Uy,yzwa,Wzwx->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,Uy,yzwa,Wzxw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,Wy,zwya,Uxwz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/3 * einsum('KxCa,Wy,zwya,Uxzw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yz,Uwya,Wwxz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/3 * einsum('KxCa,yz,Uwya,Wwzx->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/3 * einsum('KxCa,yz,Uywa,Wzwx->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yz,Uywa,Wzxw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/3 * einsum('KxCa,yz,wyWa,Uxwz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yz,wyWa,Uxzw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yz,ywWa,Uxwz->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/3 * einsum('KxCa,yz,ywWa,Uxzw->KWCU', X_baba, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvuxz->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvuzx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvxuz->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvzux->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,Uyza,ywuv,Wwvzxu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuvwx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuvxw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuwvx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,Uyza,zwuv,Wyuwxv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuxvw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,ya,Uzwy,Wwxz->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/3 * einsum('KxCa,ya,Uzwy,Wwzx->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,ya,Wzyw,Uxwz->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/3 * einsum('KxCa,ya,Wzyw,Uxzw->KWCU', X_baba, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuvwz->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuvzw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuwvz->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzWa,ywuv,Uxuwzv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuzvw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzWa,ywzu,Uxuw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/3 * einsum('KxCa,yzWa,ywzu,Uxwu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzWa,zwuv,Uxuwyv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/3 * einsum('KxCa,yzWa,zwuv,Uxuywv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/3 * einsum('KxCa,yzwa,Uuvy,Wzvuxw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uuvy,Wzvxuw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvuwx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvuxw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvwux->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvwxu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvxuw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyuvx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyuxv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyvux->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyvxu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyxvu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuvwx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuvxw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuwvx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuwxv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuxvw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/3 * einsum('KxCa,yzwa,Uyuz,Wuwx->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uyuz,Wuxw->KWCU', X_baba, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/3 * einsum('KxCa,yzwa,Wuvw,Uxvuzy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Wuvw,Uxvzuy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwuvz->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwuzv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwvuz->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwvzu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwzvu->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/3 * einsum('KxCa,yzwa,Wuzv,Uxwuvy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Wuzv,Uxwvuy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuvyz->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuvzy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuyvz->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuyzv->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuzvy->KWCU', X_baba, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/2 * einsum('KxCa,a,Ua,Wx->KWCU', X_bbbb, e_extern, t1_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,a,Uyza,Wyxz->KWCU', X_bbbb, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,a,Uyza,Wyzx->KWCU', X_bbbb, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/2 * einsum('KxCa,a,yUza,Wyxz->KWCU', X_bbbb, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,a,yzWa,Uxyz->KWCU', X_bbbb, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,a,yzWa,Uxzy->KWCU', X_bbbb, e_extern, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/2 * einsum('KxCa,Uy,ya,Wx->KWCU', X_bbbb, h_aa, t1_ae, rdm_ca, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,Uy,yzwa,Wzwx->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,Uy,yzwa,Wzxw->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/2 * einsum('KxCa,Uy,zywa,Wzxw->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,Wy,zwya,Uxwz->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,Wy,zwya,Uxzw->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yz,Uwya,Wwxz->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yz,Uwya,Wwzx->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yz,Uywa,Wzwx->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yz,Uywa,Wzxw->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/2 * einsum('KxCa,yz,wUya,Wwxz->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yz,wyWa,Uxwz->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yz,wyWa,Uxzw->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/2 * einsum('KxCa,yz,yUwa,Wzxw->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yz,ywWa,Uxwz->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yz,ywWa,Uxzw->KWCU', X_bbbb, h_aa, t1_aaae, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,Uyza,ywuv,Wwvxzu->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,Uyza,ywuv,Wwvzxu->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,Uyza,zwuv,Wyuwxv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,Uyza,zwuv,Wyuxwv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/2 * einsum('KxCa,yUza,ywuv,Wwvxzu->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/2 * einsum('KxCa,yUza,zwuv,Wyuxwv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/2 * einsum('KxCa,ya,Uyzw,Wzxw->KWCU', X_bbbb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,ya,Uzwy,Wwxz->KWCU', X_bbbb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,ya,Uzwy,Wwzx->KWCU', X_bbbb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,ya,Wzyw,Uxwz->KWCU', X_bbbb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,ya,Wzyw,Uxzw->KWCU', X_bbbb, t1_ae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzWa,ywuv,Uxuwzv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzWa,ywuv,Uxuzwv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzWa,ywzu,Uxuw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzWa,ywzu,Uxwu->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzWa,zwuv,Uxuwyv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzWa,zwuv,Uxuywv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uuvy,Wzvuxw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uuvy,Wzvxuw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvuwx->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uuvz,Wyvxwu->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyuxv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uuwv,Wzyxuv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuwxv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uyuv,Wzuxwv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Uyuz,Wuwx->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Uyuz,Wuxw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/2 * einsum('KxCa,yzwa,Uzuv,Wyuxwv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/2 * einsum('KxCa,yzwa,Uzuy,Wuxw->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Wuvw,Uxvuzy->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Wuvw,Uxvzuy->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwuzv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Wuyv,Uxwzuv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Wuzv,Uxwuvy->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Wuzv,Uxwvuy->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb -= 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuyzv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma_KWCU_bbbb += 1/6 * einsum('KxCa,yzwa,Wwuv,Uxuzyv->KWCU', X_bbbb, t1_aaae, v_aaaa, rdm_cccaaa, optimize = einsum_type)
    sigma[caea__bbbb] += ascontiguousarray(sigma_KWCU_bbbb).reshape(-1)

    mr_adc.log.timer_debug("computing sigma H1 h1-h1 CAEA-CAEE", *cput1)

# CVAA <- CAEE: NO CONTRIBUTION

# CVEA <- CAEE
def compute_sigma_vector__H1__h1_h1__CVEA_CAEE(mr_adc, X_aaaa, X_abab, X_baba, X_bbbb, sigma):
    cput1 = (logger.process_clock(), logger.perf_counter())

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    #Excitation Manifold
    cvea__aaaa = mr_adc.h1.cvea__aaaa
    cvea__abab = mr_adc.h1.cvea__abab
    cvea__baab = mr_adc.h1.cvea__baab
    cvea__bbbb = mr_adc.h1.cvea__bbbb
    cvea__baba = mr_adc.h1.cvea__baba
    cvea__abba = mr_adc.h1.cvea__abba 
 
    ## Two-electron integrals
    v_vaea = mr_adc.v2e.vaea

    # Reduced Density Matrices
    rdm_ca = mr_adc.rdm.ca
    rdm_ccaa = mr_adc.rdm.ccaa

    sigma_KLCW_aaaa  = 1/2 * einsum('KxCa,LWay,xy->KLCW', X_aaaa, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_aaaa -= 1/2 * einsum('KxCa,LyaW,xy->KLCW', X_aaaa, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_aaaa -= 1/6 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_aaaa, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_aaaa += 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_aaaa, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_aaaa += 1/2 * einsum('KxCa,LWay,xy->KLCW', X_abab, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_aaaa -= 1/3 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_abab, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_aaaa -= 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_abab, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma[cvea__aaaa] += ascontiguousarray(sigma_KLCW_aaaa).reshape(-1)

    sigma_KLCW_abab  = 1/2 * einsum('KxCa,LWay,xy->KLCW', X_aaaa, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_abab -= 1/3 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_aaaa, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abab -= 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_aaaa, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abab += 1/2 * einsum('KxCa,LWay,xy->KLCW', X_abab, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_abab -= 1/2 * einsum('KxCa,LyaW,xy->KLCW', X_abab, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_abab -= 1/6 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_abab, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abab += 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_abab, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma[cvea__abab] += ascontiguousarray(sigma_KLCW_abab).reshape(-1)

    sigma_KLCW_baab  = 1/2 * einsum('KxaC,LyaW,xy->KLCW', X_baba, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_baab -= 1/6 * einsum('KxaC,Lyaz,Wxyz->KLCW', X_baba, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_baab -= 1/3 * einsum('KxaC,Lyaz,Wxzy->KLCW', X_baba, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma[cvea__baab] += ascontiguousarray(sigma_KLCW_baab).reshape(-1)

    sigma_KLCW_bbbb  = 1/2 * einsum('KxCa,LWay,xy->KLCW', X_baba, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_bbbb -= 1/3 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_baba, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_bbbb -= 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_baba, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_bbbb += 1/2 * einsum('KxCa,LWay,xy->KLCW', X_bbbb, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_bbbb -= 1/2 * einsum('KxCa,LyaW,xy->KLCW', X_bbbb, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_bbbb -= 1/6 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_bbbb, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_bbbb += 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_bbbb, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma[cvea__bbbb] += ascontiguousarray(sigma_KLCW_bbbb).reshape(-1)

    sigma_KLCW_baba  = 1/2 * einsum('KxCa,LWay,xy->KLCW', X_baba, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_baba -= 1/2 * einsum('KxCa,LyaW,xy->KLCW', X_baba, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_baba -= 1/6 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_baba, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_baba += 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_baba, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_baba += 1/2 * einsum('KxCa,LWay,xy->KLCW', X_bbbb, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_baba -= 1/3 * einsum('KxCa,Lyaz,Wxyz->KLCW', X_bbbb, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_baba -= 1/6 * einsum('KxCa,Lyaz,Wxzy->KLCW', X_bbbb, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma[cvea__baba] += ascontiguousarray(sigma_KLCW_baba).reshape(-1)

    sigma_KLCW_abba  = 1/2 * einsum('KxaC,LyaW,xy->KLCW', X_abab, v_vaea, rdm_ca, optimize = einsum_type)
    sigma_KLCW_abba -= 1/6 * einsum('KxaC,Lyaz,Wxyz->KLCW', X_abab, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma_KLCW_abba -= 1/3 * einsum('KxaC,Lyaz,Wxzy->KLCW', X_abab, v_vaea, rdm_ccaa, optimize = einsum_type)
    sigma[cvea__abba] += ascontiguousarray(sigma_KLCW_abba).reshape(-1)

    mr_adc.log.timer_debug("computing sigma H1 h1-h1 CVEA-CAEE", *cput1)

# CVEE <- CAEE
def compute_sigma_vector__H1__h1_h1__CVEE_CAEE(mr_adc, X_aaaa, X_abab, X_baba, X_bbbb, sigma):
    cput1 = (logger.process_clock(), logger.perf_counter())

    # Einsum definition from kernel
    einsum = mr_adc.interface.einsum
    einsum_type = mr_adc.interface.einsum_type

    #Excitation Manifold
    cvee__aaaa = mr_adc.h1.cvee__aaaa
    cvee__abab = mr_adc.h1.cvee__abab
    cvee__baba = mr_adc.h1.cvee__baba
    cvee__bbbb = mr_adc.h1.cvee__bbbb 

    ## Indices
    ee_tril_ind = mr_adc.h1.ee_tril_ind 

    ## Molecular Orbitals Energies
    e_val = mr_adc.mo_energy.v

    ## One-electron integrals
    h_va = mr_adc.h1eff.va
    h_aa = mr_adc.h1eff.aa

    ## Two-electron integrals
    v_xxva = mr_adc.v2e.xxva
    v_vxxa = mr_adc.v2e.vxxa
    v_vaaa = mr_adc.v2e.vaaa
    v_vaee = mr_adc.v2e.vaee
    v_veea = mr_adc.v2e.veea
    v_aaaa = mr_adc.v2e.aaaa

    ## Amplitudes
    t1_va = mr_adc.t1.va
    t1_vaaa = mr_adc.t1.vaaa

    # Reduced Density Matrices
    rdm_ca = mr_adc.rdm.ca
    rdm_ccaa = mr_adc.rdm.ccaa

    sigma_KLCD_aaaa =- einsum('KxCD,Lx->KLCD', X_aaaa, h_va, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('KxCD,L,Lx->KLCD', X_aaaa, e_val, t1_va, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,xy,Ly->KLCD', X_aaaa, h_aa, t1_va, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,Lxyz,yz->KLCD', X_aaaa, v_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Lyzx,zy->KLCD', X_aaaa, v_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_aaaa, v_veea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxCa,LyaD,xy->KLCD', X_aaaa, v_vaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxDa,LCay,xy->KLCD', X_aaaa, v_veea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxDa,LyaC,xy->KLCD', X_aaaa, v_vaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('ixCD,KiLy,xy->KLCD', X_aaaa, v_xxva, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('ixCD,LiKy,xy->KLCD', X_aaaa, v_vxxa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_abab, v_veea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxDa,LCay,xy->KLCD', X_abab, v_veea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('KxCD,L,Lyxz,yz->KLCD', X_aaaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxCD,L,Lyzx,yz->KLCD', X_aaaa, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,xy,Lzwy,zw->KLCD', X_aaaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,xy,Lzyw,zw->KLCD', X_aaaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,yz,Lwxy,zw->KLCD', X_aaaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,yz,Lwyx,zw->KLCD', X_aaaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxCD,yz,Lywx,zw->KLCD', X_aaaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('KxCD,yz,Lyxw,zw->KLCD', X_aaaa, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,Ly,xyzw,zw->KLCD', X_aaaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Ly,xzwy,wz->KLCD', X_aaaa, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa += einsum('KxCD,Lyxz,ywuv,zuwv->KLCD', X_aaaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,Lyxz,zwuv,yuwv->KLCD', X_aaaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Lyzw,xuvw,yuvz->KLCD', X_aaaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Lyzw,xuvz,yuwv->KLCD', X_aaaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxCD,Lyzw,xuyv,zwuv->KLCD', X_aaaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Lyzw,xwuv,yvzu->KLCD', X_aaaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Lyzw,xwuz,yu->KLCD', X_aaaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,Lyzw,xzuv,yvwu->KLCD', X_aaaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa -= einsum('KxCD,Lyzw,xzuw,yu->KLCD', X_aaaa, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_aaaa -= 1/2 * einsum('KxCD,Lyzx,ywuv,zuwv->KLCD', X_aaaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_aaaa += 1/2 * einsum('KxCD,Lyzx,zwuv,yuwv->KLCD', X_aaaa, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma[cvee__aaaa] += ascontiguousarray(sigma_KLCD_aaaa[:, :, ee_tril_ind[0], ee_tril_ind[1]]).reshape(-1)

    sigma_KLCD_abab =- einsum('KxCD,Lx->KLCD', X_abab, h_va, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_aaaa, v_veea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += einsum('KxCD,L,Lx->KLCD', X_abab, e_val, t1_va, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,xy,Ly->KLCD', X_abab, h_aa, t1_va, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,Lxyz,yz->KLCD', X_abab, v_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Lyzx,zy->KLCD', X_abab, v_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_abab, v_veea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('KxCa,LyaD,xy->KLCD', X_abab, v_vaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('KxaD,LyaC,xy->KLCD', X_abab, v_vaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('ixCD,KiLy,xy->KLCD', X_abab, v_xxva, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('ixDC,LiKy,xy->KLCD', X_baba, v_vxxa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += einsum('KxCD,L,Lyxz,yz->KLCD', X_abab, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('KxCD,L,Lyzx,yz->KLCD', X_abab, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,xy,Lzwy,zw->KLCD', X_abab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,xy,Lzyw,zw->KLCD', X_abab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,yz,Lwxy,zw->KLCD', X_abab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,yz,Lwyx,zw->KLCD', X_abab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('KxCD,yz,Lywx,zw->KLCD', X_abab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += einsum('KxCD,yz,Lyxw,zw->KLCD', X_abab, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,Ly,xyzw,zw->KLCD', X_abab, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Ly,xzwy,wz->KLCD', X_abab, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab += einsum('KxCD,Lyxz,ywuv,zuwv->KLCD', X_abab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,Lyxz,zwuv,yuwv->KLCD', X_abab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Lyzw,xuvw,yuvz->KLCD', X_abab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Lyzw,xuvz,yuwv->KLCD', X_abab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('KxCD,Lyzw,xuyv,zwuv->KLCD', X_abab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Lyzw,xwuv,yvzu->KLCD', X_abab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Lyzw,xwuz,yu->KLCD', X_abab, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,Lyzw,xzuv,yvwu->KLCD', X_abab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab -= einsum('KxCD,Lyzw,xzuw,yu->KLCD', X_abab, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_abab -= 1/2 * einsum('KxCD,Lyzx,ywuv,zuwv->KLCD', X_abab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_abab += 1/2 * einsum('KxCD,Lyzx,zwuv,yuwv->KLCD', X_abab, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma[cvee__abab] += ascontiguousarray(sigma_KLCD_abab).reshape(-1)

    sigma_KLCD_baba =- einsum('KxCD,Lx->KLCD', X_baba, h_va, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('ixDC,LiKy,xy->KLCD', X_abab, v_vxxa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba += einsum('KxCD,L,Lx->KLCD', X_baba, e_val, t1_va, optimize = einsum_type)
    sigma_KLCD_baba -= einsum('KxCD,xy,Ly->KLCD', X_baba, h_aa, t1_va, optimize = einsum_type)
    sigma_KLCD_baba -= einsum('KxCD,Lxyz,yz->KLCD', X_baba, v_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('KxCD,Lyzx,zy->KLCD', X_baba, v_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_baba, v_veea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba -= 1/2 * einsum('KxCa,LyaD,xy->KLCD', X_baba, v_vaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba -= 1/2 * einsum('KxaD,LyaC,xy->KLCD', X_baba, v_vaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('ixCD,KiLy,xy->KLCD', X_baba, v_xxva, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_bbbb, v_veea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba += einsum('KxCD,L,Lyxz,yz->KLCD', X_baba, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba -= 1/2 * einsum('KxCD,L,Lyzx,yz->KLCD', X_baba, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('KxCD,xy,Lzwy,zw->KLCD', X_baba, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba -= einsum('KxCD,xy,Lzyw,zw->KLCD', X_baba, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba -= einsum('KxCD,yz,Lwxy,zw->KLCD', X_baba, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('KxCD,yz,Lwyx,zw->KLCD', X_baba, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba -= 1/2 * einsum('KxCD,yz,Lywx,zw->KLCD', X_baba, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba += einsum('KxCD,yz,Lyxw,zw->KLCD', X_baba, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba -= einsum('KxCD,Ly,xyzw,zw->KLCD', X_baba, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('KxCD,Ly,xzwy,wz->KLCD', X_baba, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba += einsum('KxCD,Lyxz,ywuv,zuwv->KLCD', X_baba, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_baba -= einsum('KxCD,Lyxz,zwuv,yuwv->KLCD', X_baba, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('KxCD,Lyzw,xuvw,yuvz->KLCD', X_baba, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('KxCD,Lyzw,xuvz,yuwv->KLCD', X_baba, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_baba -= 1/2 * einsum('KxCD,Lyzw,xuyv,zwuv->KLCD', X_baba, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('KxCD,Lyzw,xwuv,yvzu->KLCD', X_baba, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('KxCD,Lyzw,xwuz,yu->KLCD', X_baba, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba -= einsum('KxCD,Lyzw,xzuv,yvwu->KLCD', X_baba, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_baba -= einsum('KxCD,Lyzw,xzuw,yu->KLCD', X_baba, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_baba -= 1/2 * einsum('KxCD,Lyzx,ywuv,zuwv->KLCD', X_baba, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_baba += 1/2 * einsum('KxCD,Lyzx,zwuv,yuwv->KLCD', X_baba, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma[cvee__baba] += ascontiguousarray(sigma_KLCD_baba).reshape(-1)

    sigma_KLCD_bbbb =- einsum('KxCD,Lx->KLCD', X_bbbb, h_va, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_baba, v_veea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxDa,LCay,xy->KLCD', X_baba, v_veea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('KxCD,L,Lx->KLCD', X_bbbb, e_val, t1_va, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,xy,Ly->KLCD', X_bbbb, h_aa, t1_va, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,Lxyz,yz->KLCD', X_bbbb, v_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Lyzx,zy->KLCD', X_bbbb, v_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCa,LDay,xy->KLCD', X_bbbb, v_veea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxCa,LyaD,xy->KLCD', X_bbbb, v_vaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxDa,LCay,xy->KLCD', X_bbbb, v_veea, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxDa,LyaC,xy->KLCD', X_bbbb, v_vaee, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('ixCD,KiLy,xy->KLCD', X_bbbb, v_xxva, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('ixCD,LiKy,xy->KLCD', X_bbbb, v_vxxa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('KxCD,L,Lyxz,yz->KLCD', X_bbbb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxCD,L,Lyzx,yz->KLCD', X_bbbb, e_val, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,xy,Lzwy,zw->KLCD', X_bbbb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,xy,Lzyw,zw->KLCD', X_bbbb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,yz,Lwxy,zw->KLCD', X_bbbb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,yz,Lwyx,zw->KLCD', X_bbbb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxCD,yz,Lywx,zw->KLCD', X_bbbb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('KxCD,yz,Lyxw,zw->KLCD', X_bbbb, h_aa, t1_vaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,Ly,xyzw,zw->KLCD', X_bbbb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Ly,xzwy,wz->KLCD', X_bbbb, t1_va, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb += einsum('KxCD,Lyxz,ywuv,zuwv->KLCD', X_bbbb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,Lyxz,zwuv,yuwv->KLCD', X_bbbb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Lyzw,xuvw,yuvz->KLCD', X_bbbb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Lyzw,xuvz,yuwv->KLCD', X_bbbb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxCD,Lyzw,xuyv,zwuv->KLCD', X_bbbb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Lyzw,xwuv,yvzu->KLCD', X_bbbb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Lyzw,xwuz,yu->KLCD', X_bbbb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,Lyzw,xzuv,yvwu->KLCD', X_bbbb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb -= einsum('KxCD,Lyzw,xzuw,yu->KLCD', X_bbbb, t1_vaaa, v_aaaa, rdm_ca, optimize = einsum_type)
    sigma_KLCD_bbbb -= 1/2 * einsum('KxCD,Lyzx,ywuv,zuwv->KLCD', X_bbbb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma_KLCD_bbbb += 1/2 * einsum('KxCD,Lyzx,zwuv,yuwv->KLCD', X_bbbb, t1_vaaa, v_aaaa, rdm_ccaa, optimize = einsum_type)
    sigma[cvee__bbbb] += ascontiguousarray(sigma_KLCD_bbbb[:, :, ee_tril_ind[0], ee_tril_ind[1]]).reshape(-1)

    mr_adc.log.timer_debug("computing sigma H1 h1-h1 CVEE-CAEE", *cput1)

